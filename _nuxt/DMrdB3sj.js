import{a as I}from"./DJrXkGIA.js";import{g as y,_ as w,c as o,o as n,a as r,O as a,t as d,$ as V,d as S,b,F as f,r as g,a0 as B,W as u,A as K}from"#entry";const v=y({name:"BaseAutocomplete",emits:["update:modelValue","change"],components:{BaseIcon:I},props:{modelValue:[String,Number,Array],label:String,placeholder:String,appendIcon:String,items:Array,autoselect:Boolean,multiple:Boolean,showKey:Boolean,loading:Boolean,error:String,fieldKey:{type:String,default:"key"},fieldValue:{type:String,default:"value"},emitValue:{type:Boolean,default:!1}},data(){return{searchValue:"",focused:!1,visibleDropdown:!1,focusedItem:-1,selectedItems:[]}},computed:{filteredItems(){if(this.items)if(this.multiple){const e=this.items?.filter(t=>{const s=String(t[this.fieldKey]).toLowerCase(),l=String(t[this.fieldValue]).toLowerCase();return s.includes(this.searchValue.toLowerCase())||l.includes(this.searchValue.toLowerCase())});if(this.selectedItems.length){const t=this.selectedItems.map(s=>String(s[this.fieldKey]));return e.filter(s=>!t.includes(String(s[this.fieldKey])))}return e}else if(this.selectedItems.length){const e=this.selectedItems.map(t=>String(t[this.fieldKey]));return this.items.filter(t=>!e.includes(String(t[this.fieldKey])))}else return this.items?.filter(t=>{const s=String(t[this.fieldKey]).toLowerCase(),l=String(t[this.fieldValue]).toLowerCase();return s.includes(this.searchValue.toLowerCase())||l.includes(this.searchValue.toLowerCase())});return[]}},methods:{syncFromModel(e){const t=this.getEmitField();if(this.multiple){const m=(Array.isArray(e)?e:e!=null?[e]:[]).map(c=>this.items?.find(h=>String(h[t])===String(c))).filter(Boolean);this.selectedItems=m,this.searchValue="";return}if(e==null||e===""){this.selectedItems=[],this.searchValue="";return}const s=this.items?.find(l=>String(l[t])===String(e));s?(this.selectedItems=[s],this.searchValue=s[this.fieldValue]):(this.selectedItems=[],this.searchValue=String(e))},getEmitField(){return this.emitValue?this.fieldValue:this.fieldKey},selectItem(e){if(e){let t;const s=this.getEmitField();this.multiple?(this.searchValue="",this.selectedItems.push(e),t=this.selectedItems.map(l=>String(l[s]))):(this.searchValue=e[this.fieldValue],this.selectedItems=[e],t=e[s]),this.$emit("update:modelValue",t),this.$emit("change",t),this.hideDropdown()}},resetItems(){this.searchValue="",this.selectedItems=[],this.$emit("update:modelValue",void 0),this.$emit("change",void 0)},showDropdown(){this.visibleDropdown=!0},hideDropdown(){setTimeout(()=>{this.visibleDropdown=!1},10)},onInput(){this.showDropdown(),!this.multiple&&this.selectedItems.length&&this.selectedItems.pop()},onKeydown(e){switch(e.keyCode){case 9:case 13:this.filteredItems?.length&&this.visibleDropdown&&(this.selectItem(this.filteredItems[this.focusedItem]),e.stopPropagation(),e.preventDefault());break;case 27:this.visibleDropdown&&(this.hideDropdown(),e.stopPropagation());break;case 8:this.searchValue===""&&(e.ctrlKey?this.selectedItems=[]:this.selectedItems.pop());break;case 38:if(this.filteredItems){if(!this.visibleDropdown){this.showDropdown();return}--this.focusedItem<0&&(this.focusedItem=this.filteredItems?.length-1)}break;case 40:if(this.filteredItems){if(!this.visibleDropdown){this.showDropdown();return}++this.focusedItem>=this.filteredItems?.length&&(this.focusedItem=0)}break}},onFocusOrBlur(e){e?this.showDropdown():this.hideDropdown(),this.focused=e},init(){if(this.modelValue){const e=this.getEmitField();if(this.multiple&&Array.isArray(this.modelValue)){const t=this.modelValue.map(s=>this.items?.find(l=>String(l[e])===String(s))).filter(Boolean);if(t.length){this.searchValue="",this.selectedItems=t;const s=t.map(l=>String(l[e]));this.$emit("update:modelValue",s)}}else{const t=this.items?.find(s=>String(s[e])===String(this.modelValue));t&&this.selectItem(t)}}else this.autoselect&&this.items?.length&&this.selectItem(this.items[0])}},watch:{modelValue:{deep:!0,immediate:!0,handler(e){this.syncFromModel(e)}},items(e,t){JSON.stringify(e)!==JSON.stringify(t)&&this.syncFromModel(this.modelValue)}},created(){this.init()},unmounted(){this.$emit("update:modelValue",void 0)}}),D={class:"header",style:{display:"flex","align-items":"start","padding-right":"1em"}},k={key:0,class:"caption-container",style:{flex:"auto 1 1"}},F={class:"caption"},C={key:1,class:"error-container",style:{display:"flex",gap:".2em","justify-content":"flex-end","font-size":"14px",color:"red",opacity:".6","line-height":"1.4em"}},$={class:"error-message"},A={class:"input-container"},L={key:0,class:"selected-items"},N=["placeholder"],O={key:1,class:"loader"},M={key:0,class:"dropdown"},E=["onMousedown"],z={key:0,style:{opacity:".3","margin-left":".3em"}},T={class:"dropdown-item"},j={key:0};function J(e,t,s,l,m,c){const h=K("BaseIcon");return n(),o("div",{class:u(["base-autocomplete-wrapper",{invalid:e.error}])},[r("label",null,[r("header",D,[e.label?(n(),o("div",k,[r("span",F,d(e.label),1)])):a("",!0),e.error?(n(),o("div",C,[r("span",$,d(e.error),1)])):a("",!0)]),r("div",A,[e.multiple&&e.selectedItems.length?(n(),o("span",L,[(n(!0),o(f,null,g(e.selectedItems,i=>(n(),o("span",{class:"item-badge",key:i[e.fieldKey]},[r("span",null,d(i[e.fieldValue]),1)]))),128))])):a("",!0),V(r("input",{type:"text",placeholder:e.placeholder,class:u({selected:e.selectedItems.length}),"onUpdate:modelValue":t[0]||(t[0]=i=>e.searchValue=i),onFocus:t[1]||(t[1]=i=>e.onFocusOrBlur(!0)),onBlur:t[2]||(t[2]=i=>e.onFocusOrBlur(!1)),onInput:t[3]||(t[3]=(...i)=>e.onInput&&e.onInput(...i)),onKeydown:t[4]||(t[4]=(...i)=>e.onKeydown&&e.onKeydown(...i))},null,42,N),[[B,e.searchValue]]),S(" "+d(e.appendIcon)+" ",1),b(h,{class:"append-icon",size:"1.4em",name:e.appendIcon??"mdi-menu-down"},null,8,["name"]),e.loading?(n(),o("div",O)):a("",!0)])]),e.visibleDropdown?(n(),o("ul",M,[(n(!0),o(f,null,g(e.filteredItems,(i,p)=>(n(),o("li",{key:p,class:u(["dropdown-item",{focusedItem:e.focusedItem===p}]),onMousedown:P=>e.selectItem(i)},[r("span",null,[r("span",null,d(i[e.fieldValue]),1),e.showKey?(n(),o("span",z,d(i[e.fieldKey]),1)):a("",!0)])],42,E))),128)),r("li",T,[e.filteredItems?.length===0?(n(),o("span",j,"Ничего не найдено")):a("",!0)])])):a("",!0)],2)}const q=Object.assign(w(v,[["render",J]]),{__name:"CommonBaseAutocomplete"});export{q as B};
