import{a as k,B as T}from"./B6RQYo7X.js";import{B as S}from"./CISv4LoY.js";import{d as D,a as A,r as g,U as R,x as o,z as t,B as y,N as V,I as _,R as h,S as f,y as l,L as d,A as a,T as z,V as C,C as N,D as I}from"#entry";const L={class:"readings-page"},U={class:"readings-container"},q={class:"readings"},E={class:"bold-title"},G={class:"account"},j={class:"small-text"},P={class:"reading-date"},$={class:"date"},F={key:0,class:"account-info"},K={class:"account-info-container"},M={class:"account-info-balance"},O={class:"amount"},H={class:"account-info-district"},J={class:"small-text"},Q={class:"message"},W={key:0,class:"account-success-message",style:{"font-size":"2em",color:"forestgreen",display:"flex","justify-content":"center","align-items":"center",gap:".2em",margin:".4em 0 0 0"}},X={key:1,class:"account-error-message",style:{"font-size":"2em",color:"#c8290f",display:"flex","justify-content":"center","align-items":"center",gap:".2em",margin:".4em 0 0 0"}},Y={key:0,class:"card-section"},Z={class:"table-wrapper"},tt={class:"issues-table"},et={class:"small-text"},st={class:"small-text"},nt={class:"small-text"},at={class:"small-text"},lt={class:"small-text date"},ot={key:1,class:"card-section"},it={class:"table-wrapper"},ct={class:"readings-table"},rt={key:2,class:"card-section"},dt={class:"table-wrapper"},ut={class:"payments-table"},mt={class:"small-text"},pt={class:"small-text amount"},yt={class:"small-text date"},_t={class:"small-text"},ht={style:{margin:".6em 0 0 0",display:"flex","align-items":"center",gap:".6em"}},kt=D({__name:"index",setup(ft){const{$api:p}=A(),r=g(""),v=g(!1),u=R({}),m=g("");async function B(){v.value=!0;const i={};r.value&&(i.search=r.value),i.limit=10,r.value&&(i.search=r.value);const e=await p("v2/facility/find",{method:"GET",query:i});{for(const s in u)delete u[s];for(const s of e.data)u[s.account]=s}v.value=!1}async function x(i){const e=await p("v2/facility/account",{method:"GET",query:{account:i.account}}),n=(await p("v1/payments/history",{method:"GET",query:{account:i.account},headers:[]})).data,c=i.account,b=u[c];u[c]={...e,...b,payments:n}}function w(i,e){p("v1/portal/readings",{method:"POST",body:{account:i.account,reading:e}}).then(s=>{x(i),setTimeout(()=>{m.value="success"})}).catch(s=>{console.error(s),setTimeout(()=>{m.value="error"})}).finally(()=>{setTimeout(()=>{m.value=""},5e3)})}return(i,e)=>(l(),o("section",L,[t("div",U,[e[13]||(e[13]=t("h1",{style:{"text-align":"center"}},"Абоненты",-1)),y(S,{modelValue:_(r),"onUpdate:modelValue":e[0]||(e[0]=s=>V(r)?r.value=s:null),autofocus:"",onSubmit:B,style:{width:"100%"},"prepend-icon":"mdi-magnify",button:"Найти",placeholder:"Поиск"},null,8,["modelValue"]),t("div",q,[(l(!0),o(h,null,f(_(u),s=>(l(),o("div",{class:"reading",key:String(s.name).slice(0,4)},[t("div",E,a(s.name),1),t("div",G,[t("span",null,a(s.account),1)]),t("div",j,a(s.address),1),t("div",P,[e[1]||(e[1]=t("span",null,"Создан: ",-1)),t("span",$,a(s.created),1)]),s.district?(l(),o("section",F,[t("section",K,[t("div",M,[e[2]||(e[2]=t("span",{class:"small-text"},"Баланс: ",-1)),t("span",O,a(s.balance),1)]),t("div",H,[e[3]||(e[3]=t("span",{class:"small-text"},"Район: ",-1)),t("span",J,a(s.district),1)])]),t("section",Q,[_(m)==="success"?(l(),o("div",W,[t("span",null,[y(k,{name:"mdi-checkbox-marked-circle",size:"1.2em"})]),e[4]||(e[4]=t("span",null," Показания приняты",-1))])):d("",!0),_(m)==="error"?(l(),o("div",X,[t("span",null,[y(k,{name:"mdi-alert-decagram",size:"1.2em"})]),e[5]||(e[5]=t("span",null," Ошибка при отправке",-1))])):d("",!0)]),Array.isArray(s?.applications)&&s.applications.length?(l(),o("section",Y,[e[7]||(e[7]=t("h2",null,"Заявки",-1)),t("div",Z,[t("table",tt,[e[6]||(e[6]=t("thead",null,[t("tr",null,[t("th",null,"Ключ"),t("th",null,"Название"),t("th",null,"Исполнитель"),t("th",null,"Статус"),t("th",null,"Дата")])],-1)),t("tbody",null,[(l(!0),o(h,null,f(s.applications,(n,c)=>(l(),o("tr",{key:c},[t("td",et,a(n.issueKey),1),t("td",st,a(n.summary),1),t("td",nt,a(n.assignee),1),t("td",at,a(n.status.name),1),t("td",lt,a(new Date(n.created).toLocaleDateString("RU-ru")),1)]))),128))])])])])):d("",!0),Array.isArray(s?.readings)&&s.readings.length?(l(),o("section",ot,[e[9]||(e[9]=t("h2",null,"История показаний",-1)),t("div",it,[t("table",ct,[e[8]||(e[8]=t("thead",null,[t("tr",null,[t("th",null,"Показание"),t("th",null,"Потребление"),t("th",null,"Дата"),t("th",null,"Отправитель")])],-1)),t("tbody",null,[(l(!0),o(h,null,f(s.readings,(n,c)=>(l(),o("tr",{key:c},[t("td",null,a(n.reading),1),t("td",{style:z({color:n.consumption>0?"green":"inherit"})},a(n.consumption),5),t("td",null,a(new Date(n.created).toLocaleDateString("RU-ru")),1),t("td",null,a(n.sender),1)]))),128))])])])])):d("",!0),Array.isArray(s?.payments)&&s.payments.length?(l(),o("section",rt,[e[11]||(e[11]=t("h2",null,"История платежей",-1)),t("div",dt,[t("table",ut,[e[10]||(e[10]=t("thead",null,[t("tr",null,[t("th",null,"Транзакция"),t("th",null,"Сумма"),t("th",null,"Дата"),t("th",null,"Услуга")])],-1)),t("tbody",null,[(l(!0),o(h,null,f(s.payments,(n,c)=>(l(),o("tr",{key:c},[t("td",mt,a(n.txnId),1),t("td",pt,a(n.amount),1),t("td",yt,a(new Date(n.created).toLocaleDateString("RU-ru")),1),t("td",_t,"["+a(n.service.id)+"] "+a(n.service.name),1)]))),128))])])])])):d("",!0)])):d("",!0),t("div",ht,[y(S,{onSubmit:n=>{w(s,n)},style:{flex:"auto 1 0"},"prepend-icon":"mdi-counter",button:"Отправить",placeholder:"Отправить показание"},null,8,["onSubmit"]),s.district?d("",!0):(l(),C(T,{key:0,onClick:n=>x(s),prependIcon:"mdi-text-box-search-outline"},{default:N(()=>[...e[12]||(e[12]=[I("Подробнее",-1)])]),_:1},8,["onClick"]))])]))),128))])])]))}});export{kt as default};
