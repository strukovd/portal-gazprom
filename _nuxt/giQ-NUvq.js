import{a as f}from"./CNGPrdfm.js";import{g as I,_ as w,A as y,c as i,o,a as n,O as r,t as a,Y as g,d as V,b as v,F as m,r as c,Z as K,T as h}from"#entry";const b=I({name:"BaseAutocomplete",emits:["update:modelValue","change"],components:{BaseIcon:f},props:{modelValue:[String,Number],label:String,placeholder:String,appendIcon:String,items:Array,autoselect:Boolean,multiple:Boolean,showKey:Boolean,loading:Boolean,error:String,fieldKey:{type:String,default:"key"},fieldValue:{type:String,default:"value"}},data(){return{searchValue:"",focused:!1,visibleDropdown:!1,focusedItem:-1,selectedItems:[]}},computed:{filteredItems(){if(this.items)if(this.multiple){const e=this.items?.filter(s=>{const l=String(s[this.fieldKey]).toLowerCase(),d=String(s[this.fieldValue]).toLowerCase();return l.includes(this.searchValue.toLowerCase())||d.includes(this.searchValue.toLowerCase())});if(this.selectedItems.length){const s=this.selectedItems.map(l=>String(l[this.fieldKey]));return e.filter(l=>!s.includes(String(l[this.fieldKey])))}return e}else if(this.selectedItems.length){const e=this.selectedItems.map(s=>String(s[this.fieldKey]));return this.items.filter(s=>!e.includes(String(s[this.fieldKey])))}else return this.items?.filter(s=>{const l=String(s[this.fieldKey]).toLowerCase(),d=String(s[this.fieldValue]).toLowerCase();return l.includes(this.searchValue.toLowerCase())||d.includes(this.searchValue.toLowerCase())});return[]}},methods:{selectItem(e){if(e){let s;this.multiple?(this.searchValue="",this.selectedItems.push(e),s=this.selectedItems.map(l=>String(l[this.fieldKey]))):(this.searchValue=e[this.fieldValue],this.selectedItems=[e],s=e[this.fieldKey]),this.$emit("update:modelValue",s),this.$emit("change",s),this.hideDropdown()}},resetItems(){this.searchValue="",this.selectedItems=[],this.$emit("update:modelValue",void 0),this.$emit("change",void 0)},showDropdown(){this.visibleDropdown=!0},hideDropdown(){setTimeout(()=>{this.visibleDropdown=!1},10)},onInput(){this.showDropdown(),!this.multiple&&this.selectedItems.length&&this.selectedItems.pop()},onKeydown(e){switch(e.keyCode){case 9:case 13:this.filteredItems?.length&&this.visibleDropdown&&(this.selectItem(this.filteredItems[this.focusedItem]),e.stopPropagation(),e.preventDefault());break;case 27:this.visibleDropdown&&(this.hideDropdown(),e.stopPropagation());break;case 8:this.searchValue===""&&(e.ctrlKey?this.selectedItems=[]:this.selectedItems.pop());break;case 38:if(this.filteredItems){if(!this.visibleDropdown){this.showDropdown();return}--this.focusedItem<0&&(this.focusedItem=this.filteredItems?.length-1)}break;case 40:if(this.filteredItems){if(!this.visibleDropdown){this.showDropdown();return}++this.focusedItem>=this.filteredItems?.length&&(this.focusedItem=0)}break}},onFocusOrBlur(e){e?this.showDropdown():this.hideDropdown(),this.focused=e},init(){if(this.modelValue){const e=this.items?.find(s=>String(s[this.fieldKey])===String(this.modelValue));this.selectItem(e)}else this.autoselect&&this.items?.length&&this.selectItem(this.items[0])}},watch:{items(e,s){JSON.stringify(e)!==JSON.stringify(s)&&this.init()}},created(){this.init()},unmounted(){this.$emit("update:modelValue",void 0)}}),S={class:"header",style:{display:"flex","align-items":"center","padding-right":"1em"}},D={key:0,class:"caption-container",style:{flex:"auto 1 1"}},k={class:"caption"},B={key:1,class:"error-container",style:{display:"flex",gap:".2em","justify-content":"flex-end","font-size":"14px",color:"red",opacity:".6","line-height":"1.4em"}},C={class:"error-message"},$={class:"input-container"},L={key:0,class:"selected-items"},N=["placeholder"],O={key:1,class:"loader"},F={key:0,class:"dropdown"},A=["onMousedown"],T={key:0,style:{opacity:".3","margin-left":".3em"}},z={class:"dropdown-item"},M={key:0};function j(e,s,l,d,J,P){const p=y("BaseIcon");return o(),i("div",{class:h(["base-autocomplete-wrapper",{invalid:e.error}])},[n("label",null,[n("header",S,[e.label?(o(),i("div",D,[n("span",k,a(e.label),1)])):r("",!0),e.error?(o(),i("div",B,[n("span",C,a(e.error),1)])):r("",!0)]),n("div",$,[e.multiple&&e.selectedItems.length?(o(),i("span",L,[(o(!0),i(m,null,c(e.selectedItems,t=>(o(),i("span",{class:"item-badge",key:t[e.fieldKey]},[n("span",null,a(t[e.fieldValue]),1)]))),128))])):r("",!0),g(n("input",{type:"text",placeholder:e.placeholder,class:h({selected:e.selectedItems.length}),"onUpdate:modelValue":s[0]||(s[0]=t=>e.searchValue=t),onFocus:s[1]||(s[1]=t=>e.onFocusOrBlur(!0)),onBlur:s[2]||(s[2]=t=>e.onFocusOrBlur(!1)),onInput:s[3]||(s[3]=(...t)=>e.onInput&&e.onInput(...t)),onKeydown:s[4]||(s[4]=(...t)=>e.onKeydown&&e.onKeydown(...t))},null,42,N),[[K,e.searchValue]]),V(" "+a(e.appendIcon)+" ",1),v(p,{class:"append-icon",size:"1.4em",name:e.appendIcon??"mdi-menu-down"},null,8,["name"]),e.loading?(o(),i("div",O)):r("",!0)])]),e.visibleDropdown?(o(),i("ul",F,[(o(!0),i(m,null,c(e.filteredItems,(t,u)=>(o(),i("li",{key:u,class:h(["dropdown-item",{focusedItem:e.focusedItem===u}]),onMousedown:E=>e.selectItem(t)},[n("span",null,[n("span",null,a(t[e.fieldValue]),1),e.showKey?(o(),i("span",T,a(t[e.fieldKey]),1)):r("",!0)])],42,A))),128)),n("li",z,[e.filteredItems?.length===0?(o(),i("span",M,"Ничего не найдено")):r("",!0)])])):r("",!0)],2)}const Z=Object.assign(w(b,[["render",j]]),{__name:"CommonBaseAutocomplete"});export{Z as B};
