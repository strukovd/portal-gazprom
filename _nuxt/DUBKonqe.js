import{g as R,E as w,m as P,R as U,_ as q,c as r,o as l,a as e,S as D,O as k,d as S,t as u,b as B,A as K,F as I,r as N,T as V,w as M,U as O,e as G,k as Q,V as W,j as v,Q as H,n as x,W as L}from"#entry";import{B as A,a as z}from"./DJrXkGIA.js";import{B as J}from"./BPW68NmM.js";import{u as X}from"./BRjPVNtu.js";const Y=R({name:"BasePageable",components:{BaseButton:A},props:{page:{type:Number,default:1},limit:{type:Number,default:10},total:{type:Number,required:!0},siblingCount:{type:Number,default:1},boundaryCount:{type:Number,default:1},showFirstLast:{type:Boolean,default:!0}},emits:["update:page","change"],setup(t,{emit:i}){const h=w(()=>Math.max(1,Math.ceil(t.total/t.limit))),c=P(Math.min(Math.max(Number(t.page),1),h.value)),y=w(()=>c.value<=1),$=w(()=>c.value>=h.value),C=w(()=>t.total===0?0:(c.value-1)*t.limit+1),g=w(()=>Math.min(c.value*t.limit,t.total)),_=w(()=>{const d=h.value,m=c.value,s=Math.max(0,t.boundaryCount),a=Math.max(0,t.siblingCount);if(d<=1)return[1];const o=[];if(a>0){const n=a*2,p=Math.max(1,m-a),f=Math.min(d,m-a+n);for(let b=p;b<=f;b++)b>0&&b<=d&&o.push(b)}else o.push(m);if(s>0){let n=[];for(let f=1;n.length<s;f++)n.push(f);let p=[];for(let f=d-s;p.length<s;f++)p.push(f+1);n[n.length-1]<o[0]?n[n.length-1]+1<o[0]&&n.push("..."):n=[],p[0]>o[o.length-1]?p[0]-1>o[o.length-1]&&p.unshift("..."):p=[],o.unshift(...n),o.push(...p)}return o});function T(d){if(typeof d!="number")return;const m=Math.min(Math.max(1,d),h.value);m!==t.page&&(i("update:page",m),i("change",m))}return U(h,d=>{t.page>d&&i("update:page",d),t.page<1&&i("update:page",1)}),{currentPage:c,pagesCount:h,shownFrom:C,shownTo:g,isFirstPage:y,isLastPage:$,items:_,goTo:T}}}),Z={class:"base-pageable"},ee={class:"bp-footer"},te={key:0,class:"bp-meta"},se={key:1,class:"bp-pager"};function ae(t,i,h,c,y,$){const C=K("BaseButton");return l(),r("div",Z,[e("main",null,[D(t.$slots,"default")]),e("footer",ee,[t.total?(l(),r("div",te,[e("span",null,[i[2]||(i[2]=S(" Показано ",-1)),e("strong",null,u(t.shownFrom),1),i[3]||(i[3]=S("–",-1)),e("strong",null,u(t.shownTo),1),i[4]||(i[4]=S(" из ",-1)),e("strong",null,u(t.total),1),S(" (страниц: "+u(t.pagesCount)+") ",1)])])):k("",!0),t.pagesCount?(l(),r("div",se,[B(C,{disabled:t.isFirstPage,prependIcon:"mdi-menu-left",variant:"secondary",onClick:i[0]||(i[0]=g=>t.goTo(t.currentPage-1)),"aria-label":"Предыдущая страница"},null,8,["disabled"]),(l(!0),r(I,null,N(t.items,(g,_)=>(l(),V(C,{key:`p-${_}-${g}`,variant:g===t.currentPage?"primary":"secondary",disabled:g===t.currentPage||g==="...",onClick:T=>t.goTo(g)},{default:M(()=>[S(u(g),1)]),_:2},1032,["variant","disabled","onClick"]))),128)),B(C,{disabled:t.isLastPage,prependIcon:"mdi-menu-right",variant:"secondary",onClick:i[1]||(i[1]=g=>t.goTo(t.currentPage+1)),"aria-label":"Следующая страница"},null,8,["disabled"])])):k("",!0)])])}const ne=Object.assign(q(Y,[["render",ae]]),{__name:"CommonBasePageable"}),oe={name:"SkeletonLoader",props:{width:{type:String,default:"100%"},height:{type:String,default:"1em"},borderRadius:{type:String,default:"8px"}},computed:{skeletonStyle(){return{width:this.width,height:this.height,borderRadius:this.borderRadius}}}};function le(t,i,h,c,y,$){return l(),r("div",{class:"base-skeleton",style:O($.skeletonStyle)},null,4)}const ie=Object.assign(q(oe,[["render",le],["__scopeId","data-v-65dc21c8"]]),{__name:"CommonBaseSkeleton"}),re={class:"issues-page"},ue={class:"issues"},de={key:0,class:"error-message"},me={class:"title"},ce={class:"flex-line"},ge={class:"issue-date"},pe={class:"date"},fe={class:"actions",style:{display:"flex","align-items":"flex-start","justify-content":"space-between",gap:".4em"}},ve={key:0,class:"invoices"},he={class:"invoices-table"},ye={class:"invoice-service"},be={key:0,class:"invoice-created-by"},ke={key:0,class:"invoice-date"},Be={class:"date"},$e={class:"invoice-amount"},Ce={class:"amount-value"},_e={key:3},Ie=R({__name:"index",setup(t){const{$api:i}=G(),h=Q(),c=X(),y=P(""),$=P(!1),C=P(0),g=P(50),_=P(""),T=["orange2","red","orange","orange3","salad","qiwi","salad2","salad3","turquoise","blue","purple","violet","violet2","pink","pink2"];async function d(m=1){$.value=!0;const s={};s.page=m,s.size=g.value;const a=h.token;if(!a){console.error("No token");return}y.value&&(s.search=y.value),i("v1/portal/issues",{query:s,method:"GET",headers:{Authorization:`Bearer ${a}`}}).then(o=>{if(o.success){const n=o.data;C.value=parseInt(o.pagination.total);const p=n.filter(Boolean);p.forEach(f=>{if(!f){console.log(`issue: ${f}`);return}const b=String(f.issueStatus),F=b.length,E=(b.charCodeAt(0)+b.charCodeAt(F-1)+F)%T.length,j=T[E];f.color=j}),c.issues=p}}).catch(o=>{const n=o.data?.message??o.response?.data?.message;_.value=n}).finally(()=>{$.value=!1})}return W(()=>{d()}),(m,s)=>(l(),r("section",re,[e("div",ue,[s[10]||(s[10]=e("h1",{style:{margin:".4em 0"}},"Заявки сотрудника",-1)),B(A,{onClick:s[0]||(s[0]=a=>("navigateTo"in m?m.navigateTo:v(x))("/issues/create")),prependIcon:"mdi-file-document-plus-outline",style:{"font-size":"1.4em","flex-basis":"auto","flex-grow":"1","margin-bottom":".4em"}},{default:M(()=>[...s[2]||(s[2]=[S("Добавить заявку",-1)])]),_:1}),B(J,{modelValue:v(y),"onUpdate:modelValue":s[1]||(s[1]=a=>H(y)?y.value=a:null),onSubmit:d,style:{width:"100%"},"prepend-icon":"mdi-magnify",button:"Найти",placeholder:"Поиск"},null,8,["modelValue"]),v(_)?(l(),r("div",de,[B(z,{name:"mdi-alert-decagram",size:"1.2em",style:{margin:"0 .4em 0 0"}}),e("span",null,u(v(_)),1)])):k("",!0),v($)?(l(),r(I,{key:1},N(5,a=>B(ie,{key:a,height:"7em",style:{margin:".2em 0"}})),64)):v(c).issues.length?(l(),V(ne,{key:2,page:1,limit:v(g),total:v(C),onChange:d},{default:M(()=>[(l(!0),r(I,null,N(v(c).issues,(a,o)=>(l(),r("div",{class:"issue",key:String(a?.id??o)},[a?(l(),r(I,{key:0},[e("div",me,u(a.summary),1),e("div",ce,[e("div",null,[e("div",ge,[s[3]||(s[3]=e("span",null,"Дата подачи: ",-1)),e("span",pe,u(a.date),1)]),e("div",null,u(a.issueKey),1)]),e("div",{class:L(["status",a.color])},u(a.issueStatus),3)]),s[8]||(s[8]=e("hr",{style:{"border-width":"0 0 1px 0","border-bottom":"1px solid #f0f0f0",margin:"1em 0"}},null,-1)),e("div",fe,[B(A,{onClick:n=>("navigateTo"in m?m.navigateTo:v(x))(`/issues/construct-pass?issueKey=${a.issueKey}`),prependIcon:"mdi-file-document-plus-outline"},{default:M(()=>[...s[4]||(s[4]=[S("Добавить строй паспорт",-1)])]),_:1},8,["onClick"]),a?.invoices?(l(),V(A,{key:0,variant:"secondary",onClick:n=>a.showInvoices=!a.showInvoices},{default:M(()=>[B(z,{name:"mdi-invoice-text-fast-outline",size:"2em",style:{margin:"0 .4em 0 0"}}),s[5]||(s[5]=e("div",null,"Счета на оплату",-1))]),_:1},8,["onClick"])):k("",!0)]),a?.showInvoices&&Array.isArray(a?.invoices)&&a.invoices.length?(l(),r("div",ve,[s[7]||(s[7]=e("h2",null,"Счета на оплату",-1)),e("table",he,[e("tbody",null,[(l(!0),r(I,null,N(a.invoices,n=>(l(),r("tr",null,[e("td",null,[e("div",ye,[e("span",null,u(n.service),1)]),n.createdBy?(l(),r("div",be,[e("span",null,u(n.createdBy),1)])):k("",!0)]),e("td",null,[n.created?(l(),r("div",ke,[e("span",Be,u(new Date(n.created).toLocaleDateString("RU-ru")),1)])):k("",!0),e("div",{class:L(["invoice-status",{payed:n.payed}])},[e("span",null,u(n.payed?"Оплачен":"Не оплачен"),1)],2),e("div",$e,[s[6]||(s[6]=e("span",null,"Сумма: ",-1)),e("span",Ce,u(n.amount),1)])])]))),256))])])])):k("",!0)],64)):k("",!0)]))),128))]),_:1},8,["limit","total"])):v(c).issues.length?k("",!0):(l(),r("div",_e,[B(z,{name:"mdi-magnify",size:"1.2em",style:{margin:"0 .4em 0 0"}}),s[9]||(s[9]=e("span",null,"Ничего не найдено",-1))]))])]))}});export{Ie as default};
