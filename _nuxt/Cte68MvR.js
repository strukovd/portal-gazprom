import{B as z,a as B}from"./B6RQYo7X.js";import{B as S}from"./CISv4LoY.js";import{d as A,a as C,r as u,U as N,x as l,z as e,B as m,N as w,I as p,R as v,S as h,y as s,L as c,A as o,D as b,V as D,C as I,T as R}from"#entry";const q={class:"readings-page"},E={class:"readings-container"},L={class:"readings"},U={class:"name"},j={class:"account"},G={class:"address"},P={class:"reading-date"},$={class:"date"},F={style:{margin:".6em 0 0 0",display:"flex","align-items":"center",gap:".6em"}},M={key:0,class:"account-info"},O={class:"account-info-balance"},H={class:"account-info-district"},J={key:0,class:"account-success-message",style:{"font-size":"2em",color:"forestgreen",display:"flex","justify-content":"center","align-items":"center",gap:".2em",margin:".4em 0 0 0"}},K={key:1,class:"account-error-message",style:{"font-size":"2em",color:"#c8290f",display:"flex","justify-content":"center","align-items":"center",gap:".2em",margin:".4em 0 0 0"}},Q={key:2},W={class:"issues-table"},X={key:3},Y={class:"readings-table"},se=A({__name:"index",setup(Z){const{$api:f}=C(),r=u(""),_=u(!1),x=u([]),y=N({}),d=u("");async function T(){_.value=!0;const i={};r.value&&(i.search=r.value),i.limit=10,r.value&&(i.search=r.value);const t=await f("v2/facility/find",{method:"GET",query:i});{x.value=t.data;for(const n of t.data)y[n.account]=n}_.value=!1}async function k(i){const t=await f("v2/facility/account",{method:"GET",query:{account:i.account}}),n=i.account,a=y[n];y[n]={...t,...a}}function V(i,t){f("v1/portal/readings",{method:"POST",body:{account:i.account,reading:t}}).then(n=>{k(i),setTimeout(()=>{d.value="success"})}).catch(n=>{console.error(n),setTimeout(()=>{d.value="error"})}).finally(()=>{setTimeout(()=>{d.value=""},5e3)})}return(i,t)=>(s(),l("section",q,[e("div",E,[t[12]||(t[12]=e("h1",{style:{"text-align":"center"}},"Абоненты",-1)),m(S,{modelValue:p(r),"onUpdate:modelValue":t[0]||(t[0]=n=>w(r)?r.value=n:null),autofocus:"",onSubmit:T,style:{width:"100%"},"prepend-icon":"mdi-magnify",button:"Найти",placeholder:"Поиск"},null,8,["modelValue"]),e("div",L,[(s(!0),l(v,null,h(p(x),n=>(s(),l("div",{class:"reading",key:String(n.name).slice(0,4)},[e("label",null,[e("div",U,o(n.name),1),e("div",j,[e("span",null,o(n.account),1)]),e("div",G,o(n.address),1),e("div",P,[t[1]||(t[1]=e("span",null,"Создан: ",-1)),e("span",$,o(n.created),1)]),e("div",F,[m(S,{onSubmit:a=>{V(n,a)},style:{flex:"auto 1 0"},"prepend-icon":"mdi-counter",button:"Отправить",placeholder:"Введите показание"},null,8,["onSubmit"]),b(" "+o(n.district)+" ",1),n.district?c("",!0):(s(),D(z,{key:0,onClick:a=>k(n),prependIcon:"mdi-text-box-search-outline"},{default:I(()=>[...t[2]||(t[2]=[b("Подробнее",-1)])]),_:1},8,["onClick"]))]),n.district?(s(),l("section",M,[e("div",O,[t[3]||(t[3]=e("span",null,"Баланс: ",-1)),e("span",null,o(n.balance),1)]),e("div",H,[t[4]||(t[4]=e("span",null,"Район: ",-1)),e("span",null,o(n.district),1)]),p(d)==="success"?(s(),l("div",J,[e("span",null,[m(B,{name:"mdi-checkbox-marked-circle",size:"1.2em"})]),t[5]||(t[5]=e("span",null," Показания приняты",-1))])):c("",!0),p(d)==="error"?(s(),l("div",K,[e("span",null,[m(B,{name:"mdi-alert-decagram",size:"1.2em"})]),t[6]||(t[6]=e("span",null," Ошибка при отправке",-1))])):c("",!0),Array.isArray(n?.applications)&&n.applications.length?(s(),l("section",Q,[t[8]||(t[8]=e("h2",null,"Заявки",-1)),e("table",W,[t[7]||(t[7]=e("thead",null,[e("tr")],-1)),e("tbody",null,[(s(!0),l(v,null,h(n.applications,(a,g)=>(s(),l("tr",{key:g},o(a),1))),128))])])])):c("",!0),Array.isArray(n?.readings)&&n.readings.length?(s(),l("section",X,[t[10]||(t[10]=e("h2",null,"История показаний",-1)),e("table",Y,[t[9]||(t[9]=e("thead",null,[e("tr",null,[e("th",null,"Показание"),e("th",null,"Потребление"),e("th",null,"Дата"),e("th",null,"Отправитель")])],-1)),e("tbody",null,[(s(!0),l(v,null,h(n.readings,(a,g)=>(s(),l("tr",{key:g},[e("td",null,o(a.reading),1),e("td",{style:R({color:a.consumption>0?"green":"inherit"})},o(a.consumption),5),e("td",null,o(new Date(a.created).toLocaleDateString("RU-ru")),1),e("td",null,o(a.sender),1)]))),128))])])])):c("",!0),t[11]||(t[11]=e("section",null,[e("h2",null,"История платежей")],-1))])):c("",!0)])]))),128))])])]))}});export{se as default};
