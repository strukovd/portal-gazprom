import{a as v,B as D}from"./6M5rhbXH.js";import{B as k}from"./WfD9c_UJ.js";import{d as A,a as R,r as S,U as B,x as o,z as t,B as _,O as V,I as p,R as h,S as g,y as l,M as u,A as a,T as z,V as C,C as I,D as N}from"#entry";const U={class:"readings-page"},q={class:"readings-container"},E={class:"readings"},L={class:"bold-title"},G={class:"account"},j={class:"small-text"},M={class:"reading-date"},O={class:"date"},P={key:0,class:"account-info"},$={class:"account-info-container"},F={class:"account-info-balance"},K={class:"amount"},H={class:"account-info-district"},J={class:"small-text"},Q={class:"message"},W={key:0,class:"account-success-message",style:{"font-size":"2em",color:"forestgreen",display:"flex","justify-content":"center","align-items":"center",gap:".2em",margin:".4em 0 0 0"}},X={key:1,class:"account-error-message",style:{"font-size":"2em",color:"#c8290f",display:"flex","justify-content":"center","align-items":"center",gap:".2em",margin:".4em 0 0 0"}},Y={key:0,class:"card-section"},Z={class:"table-wrapper"},tt={class:"issues-table"},et={class:"small-text"},st={class:"small-text"},nt={class:"small-text"},at={class:"small-text"},lt={class:"small-text date"},ot={key:1,class:"card-section"},it={class:"table-wrapper"},ct={class:"readings-table"},rt={key:2,class:"card-section"},dt={class:"table-wrapper"},ut={class:"payments-table"},mt={class:"small-text"},pt={class:"small-text amount"},yt={class:"small-text date"},_t={class:"small-text"},ht={style:{margin:".6em 0 0 0",display:"flex","align-items":"center",gap:".6em"}},kt=A({__name:"index",setup(gt){const{$api:y}=R(),d=S(""),f=S(!1),m=B({}),c=B({type:"",message:""});async function w(){f.value=!0;const i={};d.value&&(i.search=d.value),i.limit=10,d.value&&(i.search=d.value);const s=await y("v2/facility/find",{method:"GET",query:i});{for(const e in m)delete m[e];for(const e of s.data)m[e.account]=e}f.value=!1}async function x(i){const s=await y("v2/facility/account",{method:"GET",query:{account:i.account}}),n=(await y("v1/payments/history",{method:"GET",query:{account:i.account},headers:[]})).data,r=i.account,T=m[r];m[r]={...s,...T,payments:n}}function b(i,s){y("v1/portal/readings",{method:"POST",body:{account:i.account,reading:s}}).then(e=>{x(i),setTimeout(()=>{c.type="success",c.message="Показание принято"})}).catch(e=>{console.error(e),setTimeout(()=>{c.type="error",c.message=e.data.message})}).finally(()=>{setTimeout(()=>{c.type=""},1e4)})}return(i,s)=>(l(),o("section",U,[t("div",q,[s[11]||(s[11]=t("h1",{style:{"text-align":"center"}},"Абоненты",-1)),_(k,{modelValue:p(d),"onUpdate:modelValue":s[0]||(s[0]=e=>V(d)?d.value=e:null),autofocus:"",onSubmit:w,style:{width:"100%"},"prepend-icon":"mdi-magnify",button:"Найти",placeholder:"Поиск"},null,8,["modelValue"]),t("div",E,[(l(!0),o(h,null,g(p(m),e=>(l(),o("div",{class:"reading",key:String(e.name).slice(0,4)},[t("div",L,a(e.name),1),t("div",G,[t("span",null,a(e.account),1)]),t("div",j,a(e.address),1),t("div",M,[s[1]||(s[1]=t("span",null,"Создан: ",-1)),t("span",O,a(e.created),1)]),e.district?(l(),o("section",P,[t("section",$,[t("div",F,[s[2]||(s[2]=t("span",{class:"small-text"},"Баланс: ",-1)),t("span",K,a(e.balance),1)]),t("div",H,[s[3]||(s[3]=t("span",{class:"small-text"},"Район: ",-1)),t("span",J,a(e.district),1)])]),t("section",Q,[p(c).type==="success"?(l(),o("div",W,[t("span",null,[_(v,{name:"mdi-checkbox-marked-circle",size:"1.2em"})]),t("span",null,a(p(c).message),1)])):u("",!0),p(c).type==="error"?(l(),o("div",X,[t("span",null,[_(v,{name:"mdi-alert-decagram",size:"1.2em"})]),t("span",null,a(p(c).message||"Ошибка при отправке"),1)])):u("",!0)]),Array.isArray(e?.applications)&&e.applications.length?(l(),o("section",Y,[s[5]||(s[5]=t("h2",null,"Заявки",-1)),t("div",Z,[t("table",tt,[s[4]||(s[4]=t("thead",null,[t("tr",null,[t("th",null,"Ключ"),t("th",null,"Название"),t("th",null,"Исполнитель"),t("th",null,"Статус"),t("th",null,"Дата")])],-1)),t("tbody",null,[(l(!0),o(h,null,g(e.applications,(n,r)=>(l(),o("tr",{key:r},[t("td",et,a(n.issueKey),1),t("td",st,a(n.summary),1),t("td",nt,a(n.assignee),1),t("td",at,a(n.status.name),1),t("td",lt,a(new Date(n.created).toLocaleDateString("RU-ru")),1)]))),128))])])])])):u("",!0),Array.isArray(e?.readings)&&e.readings.length?(l(),o("section",ot,[s[7]||(s[7]=t("h2",null,"История показаний",-1)),t("div",it,[t("table",ct,[s[6]||(s[6]=t("thead",null,[t("tr",null,[t("th",null,"Показание"),t("th",null,"Потребление"),t("th",null,"Дата"),t("th",null,"Отправитель")])],-1)),t("tbody",null,[(l(!0),o(h,null,g(e.readings,(n,r)=>(l(),o("tr",{key:r},[t("td",null,a(n.reading),1),t("td",{style:z({color:n.consumption>0?"green":"inherit"})},a(n.consumption),5),t("td",null,a(new Date(n.created).toLocaleDateString("RU-ru")),1),t("td",null,a(n.sender),1)]))),128))])])])])):u("",!0),Array.isArray(e?.payments)&&e.payments.length?(l(),o("section",rt,[s[9]||(s[9]=t("h2",null,"История платежей",-1)),t("div",dt,[t("table",ut,[s[8]||(s[8]=t("thead",null,[t("tr",null,[t("th",null,"Транзакция"),t("th",null,"Сумма"),t("th",null,"Дата"),t("th",null,"Услуга")])],-1)),t("tbody",null,[(l(!0),o(h,null,g(e.payments,(n,r)=>(l(),o("tr",{key:r},[t("td",mt,a(n.txnId),1),t("td",pt,a(n.amount),1),t("td",yt,a(new Date(n.created).toLocaleDateString("RU-ru")),1),t("td",_t,"["+a(n.service.id)+"] "+a(n.service.name),1)]))),128))])])])])):u("",!0)])):u("",!0),t("div",ht,[_(k,{onSubmit:n=>{b(e,n)},style:{flex:"auto 1 0"},"prepend-icon":"mdi-counter",button:"Отправить",placeholder:"Отправить показание"},null,8,["onSubmit"]),e.district?u("",!0):(l(),C(D,{key:0,onClick:n=>x(e),prependIcon:"mdi-text-box-search-outline"},{default:I(()=>[...s[10]||(s[10]=[N("Подробнее",-1)])]),_:1},8,["onClick"]))])]))),128))])])]))}});export{kt as default};
