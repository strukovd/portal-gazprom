import{g as A,E as P,m as M,R as j,_ as E,c as p,o as d,a as l,S as q,O as w,d as C,t as v,b as $,A as O,F as N,r as I,T as L,w as _,U as R,e as U,k as K,V as x,j as c,Q as D,n as F}from"#entry";import{B as V,a as z}from"./DJrXkGIA.js";import{B as G}from"./BPW68NmM.js";import{u as Q}from"./CBQEV4ZP.js";const H=A({name:"BasePageable",components:{BaseButton:V},props:{page:{type:Number,default:1},limit:{type:Number,default:10},total:{type:Number,required:!0},siblingCount:{type:Number,default:1},boundaryCount:{type:Number,default:1},showFirstLast:{type:Boolean,default:!0}},emits:["update:page","change"],setup(e,{emit:a}){const f=P(()=>Math.max(1,Math.ceil(e.total/e.limit))),r=M(Math.min(Math.max(Number(e.page),1),f.value)),h=P(()=>r.value<=1),b=P(()=>r.value>=f.value),k=P(()=>e.total===0?0:(r.value-1)*e.limit+1),u=P(()=>Math.min(r.value*e.limit,e.total)),B=P(()=>{const n=f.value,t=r.value,s=Math.max(0,e.boundaryCount),m=Math.max(0,e.siblingCount);if(n<=1)return[1];const o=[];if(m>0){const i=m*2,g=Math.max(1,t-m),y=Math.min(n,t-m+i);for(let T=g;T<=y;T++)T>0&&T<=n&&o.push(T)}else o.push(t);if(s>0){let i=[];for(let y=1;i.length<s;y++)i.push(y);let g=[];for(let y=n-s;g.length<s;y++)g.push(y+1);i[i.length-1]<o[0]?i[i.length-1]+1<o[0]&&i.push("..."):i=[],g[0]>o[o.length-1]?g[0]-1>o[o.length-1]&&g.unshift("..."):g=[],o.unshift(...i),o.push(...g)}return o});function S(n){if(typeof n!="number")return;const t=Math.min(Math.max(1,n),f.value);t!==e.page&&(a("update:page",t),a("change",t))}return j(f,n=>{e.page>n&&a("update:page",n),e.page<1&&a("update:page",1)}),{currentPage:r,pagesCount:f,shownFrom:k,shownTo:u,isFirstPage:h,isLastPage:b,items:B,goTo:S}}}),J={class:"base-pageable"},W={class:"bp-footer"},X={key:0,class:"bp-meta"},Y={key:1,class:"bp-pager"};function Z(e,a,f,r,h,b){const k=O("BaseButton");return d(),p("div",J,[l("main",null,[q(e.$slots,"default")]),l("footer",W,[e.total?(d(),p("div",X,[l("span",null,[a[2]||(a[2]=C(" Показано ",-1)),l("strong",null,v(e.shownFrom),1),a[3]||(a[3]=C("–",-1)),l("strong",null,v(e.shownTo),1),a[4]||(a[4]=C(" из ",-1)),l("strong",null,v(e.total),1),C(" (страниц: "+v(e.pagesCount)+") ",1)])])):w("",!0),e.pagesCount?(d(),p("div",Y,[$(k,{disabled:e.isFirstPage,prependIcon:"mdi-menu-left",variant:"secondary",onClick:a[0]||(a[0]=u=>e.goTo(e.currentPage-1)),"aria-label":"Предыдущая страница"},null,8,["disabled"]),(d(!0),p(N,null,I(e.items,(u,B)=>(d(),L(k,{key:`p-${B}-${u}`,variant:u===e.currentPage?"primary":"secondary",disabled:u===e.currentPage||u==="...",onClick:S=>e.goTo(u)},{default:_(()=>[C(v(u),1)]),_:2},1032,["variant","disabled","onClick"]))),128)),$(k,{disabled:e.isLastPage,prependIcon:"mdi-menu-right",variant:"secondary",onClick:a[1]||(a[1]=u=>e.goTo(e.currentPage+1)),"aria-label":"Следующая страница"},null,8,["disabled"])])):w("",!0)])])}const ee=Object.assign(E(H,[["render",Z]]),{__name:"CommonBasePageable"}),te={name:"SkeletonLoader",props:{width:{type:String,default:"100%"},height:{type:String,default:"1em"},borderRadius:{type:String,default:"8px"}},computed:{skeletonStyle(){return{width:this.width,height:this.height,borderRadius:this.borderRadius}}}};function se(e,a,f,r,h,b){return d(),p("div",{class:"base-skeleton",style:R(b.skeletonStyle)},null,4)}const ae=Object.assign(E(te,[["render",se],["__scopeId","data-v-65dc21c8"]]),{__name:"CommonBaseSkeleton"}),ne={class:"issues-page"},oe={class:"issues"},le={key:0,class:"error-message"},ie={class:"title"},re={class:"flex-line"},ue={class:"issue-date"},de={class:"date"},me={key:3},he=A({__name:"index",setup(e){const{$api:a}=U(),f=K(),r=Q(),h=M(""),b=M(!1),k=M(0),u=M(50),B=M("");async function S(n=1){b.value=!0;const t={};t.page=n,t.size=u.value;const s=f.token;if(!s){console.error("No token");return}h.value&&(t.search=h.value),a("v1/portal/issues",{query:t,method:"GET",headers:{Authorization:`Bearer ${s}`}}).then(m=>{if(m.success){const o=m.data;k.value=parseInt(m.pagination.total);const i=["#0079C1","#14cf34","#e3ce31"];o.forEach(g=>{const y=i[Math.floor(Math.random()*i.length)];g.color=y}),r.issues=o}}).catch(m=>{const o=m.data?.message??m.response?.data?.message;B.value=o}).finally(()=>{b.value=!1})}return x(()=>{S()}),(n,t)=>(d(),p("section",ne,[l("div",oe,[t[6]||(t[6]=l("h1",{style:{margin:".4em 0"}},"Заявки сотрудника",-1)),$(V,{onClick:t[0]||(t[0]=s=>("navigateTo"in n?n.navigateTo:c(F))("/issues/create")),prependIcon:"mdi-file-document-plus-outline",style:{"font-size":"1.4em","flex-basis":"auto","flex-grow":"1","margin-bottom":".4em"}},{default:_(()=>[...t[2]||(t[2]=[C("Добавить заявку",-1)])]),_:1}),$(G,{modelValue:c(h),"onUpdate:modelValue":t[1]||(t[1]=s=>D(h)?h.value=s:null),onSubmit:S,style:{width:"100%"},"prepend-icon":"mdi-magnify",button:"Найти",placeholder:"Поиск"},null,8,["modelValue"]),c(B)?(d(),p("div",le,[$(z,{name:"mdi-alert-decagram",size:"1.2em",style:{margin:"0 .4em 0 0"}}),l("span",null,v(c(B)),1)])):w("",!0),c(b)?(d(),p(N,{key:1},I(5,s=>$(ae,{key:s,height:"7em",style:{margin:".2em 0"}})),64)):c(r).issues.length?(d(),L(ee,{key:2,page:1,limit:c(u),total:c(k),onChange:S},{default:_(()=>[(d(!0),p(N,null,I(c(r).issues,s=>(d(),p("div",{class:"issue",key:String(s.summary).slice(0,4)},[l("div",ie,v(s.summary),1),l("div",re,[l("div",ue,[t[3]||(t[3]=l("span",null,"Дата подачи: ",-1)),l("span",de,v(s.date),1)]),l("div",{class:"status",style:R({background:s.color})},v(s.issueStatus),5)]),$(V,{onClick:m=>("navigateTo"in n?n.navigateTo:c(F))(`/issues/construct-pass?issueKey=${s.issueKey}`),prependIcon:"mdi-file-document-plus-outline"},{default:_(()=>[...t[4]||(t[4]=[C("Добавить строй паспорт",-1)])]),_:1},8,["onClick"])]))),128))]),_:1},8,["limit","total"])):c(r).issues.length?w("",!0):(d(),p("div",me,[$(z,{name:"mdi-magnify",size:"1.2em",style:{margin:"0 .4em 0 0"}}),t[5]||(t[5]=l("span",null,"Ничего не найдено",-1))]))])]))}});export{he as default};
