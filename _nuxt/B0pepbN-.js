import{B as T,a as h}from"./DV1Bf_Kq.js";import{B as _}from"./BS8dJtqu.js";import{d as V,a as z,r as d,x as l,z as e,B as m,N as C,I as f,R as x,S as k,y as a,L as u,A as o,U as N,C as w,D as A,T as R}from"#entry";const D={class:"readings-page"},b={class:"readings-container"},q={class:"readings"},E={class:"name"},L={class:"account"},U={class:"address"},j={class:"reading-date"},G={class:"date"},P={style:{margin:".6em 0 0 0",display:"flex","align-items":"center",gap:".6em"}},$={key:0,class:"account-info"},F={class:"account-info-balance"},M={class:"account-info-district"},O={key:0,class:"account-success-message",style:{"font-size":"2em",color:"forestgreen",display:"flex","justify-content":"center","align-items":"center",gap:".2em",margin:".4em 0 0 0"}},H={key:1,class:"account-error-message",style:{"font-size":"2em",color:"#c8290f",display:"flex","justify-content":"center","align-items":"center",gap:".2em",margin:".4em 0 0 0"}},J={key:2,class:"readings-table"},Y=V({__name:"index",setup(K){const{$api:p}=z(),c=d(""),y=d(!1),g=d([]),r=d("");async function B(){y.value=!0;const s={};c.value&&(s.search=c.value),s.limit=10,c.value&&(s.search=c.value);const t=await p("v2/facility/find",{method:"GET",query:s});g.value=t.data,y.value=!1}async function v(s){const t=await p("v2/facility/account",{method:"GET",query:{account:s.account}});s.accountInfo=t}function I(s,t){p("v1/portal/readings",{method:"POST",body:{account:s.account,reading:t}}).then(n=>{v(s),setTimeout(()=>{r.value="success"})}).catch(n=>{console.error(n),setTimeout(()=>{r.value="error"})}).finally(()=>{setTimeout(()=>{r.value=""},5e3)})}return(s,t)=>(a(),l("section",D,[e("div",b,[t[8]||(t[8]=e("h1",null,"Показания",-1)),m(_,{modelValue:f(c),"onUpdate:modelValue":t[0]||(t[0]=n=>C(c)?c.value=n:null),autofocus:"",onSubmit:B,style:{width:"100%"},"prepend-icon":"mdi-magnify",button:"Найти",placeholder:"Поиск"},null,8,["modelValue"]),e("div",q,[(a(!0),l(x,null,k(f(g),n=>(a(),l("div",{class:"reading",key:String(n.name).slice(0,4)},[e("label",null,[e("div",E,o(n.name),1),e("div",L,[e("span",null,o(n.account),1)]),e("div",U,o(n.address),1),e("div",j,[t[1]||(t[1]=e("span",null,"Создан: ",-1)),e("span",G,o(n.created),1)]),e("div",P,[m(_,{onSubmit:i=>{I(n,i)},style:{flex:"auto 1 0"},"prepend-icon":"mdi-counter",button:"Отправить",placeholder:"Введите показание"},null,8,["onSubmit"]),n.accountInfo?u("",!0):(a(),N(T,{key:0,onClick:i=>v(n),prependIcon:"mdi-text-box-search-outline"},{default:w(()=>[...t[2]||(t[2]=[A("Подробнее",-1)])]),_:1},8,["onClick"]))]),n.accountInfo?(a(),l("section",$,[e("div",F,[t[3]||(t[3]=e("span",null,"Баланс: ",-1)),e("span",null,o(n.accountInfo.balance),1)]),e("div",M,[t[4]||(t[4]=e("span",null,"Район: ",-1)),e("span",null,o(n.accountInfo.district),1)]),f(r)==="success"?(a(),l("div",O,[e("span",null,[m(h,{name:"mdi-checkbox-marked-circle",size:"1.2em"})]),t[5]||(t[5]=e("span",null," Показания приняты",-1))])):u("",!0),f(r)==="error"?(a(),l("div",H,[e("span",null,[m(h,{name:"mdi-alert-decagram",size:"1.2em"})]),t[6]||(t[6]=e("span",null," Ошибка при отправке",-1))])):u("",!0),Array.isArray(n.accountInfo?.readings)&&n.accountInfo.readings.length?(a(),l("table",J,[t[7]||(t[7]=e("thead",null,[e("tr",null,[e("th",null,"Показание"),e("th",null,"Потребление"),e("th",null,"Дата"),e("th",null,"Отправитель")])],-1)),e("tbody",null,[(a(!0),l(x,null,k(n.accountInfo.readings,(i,S)=>(a(),l("tr",{key:S},[e("td",null,o(i.reading),1),e("td",{style:R({color:i.consumption>0?"green":"inherit"})},o(i.consumption),5),e("td",null,o(new Date(i.created).toLocaleDateString("RU-ru")),1),e("td",null,o(i.sender),1)]))),128))])])):u("",!0)])):u("",!0)])]))),128))])])]))}});export{Y as default};
