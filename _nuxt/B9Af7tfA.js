import{g as w,_ as T,c as p,o as r,F as G,r as E,U as K,W as I,T as R,O as B,a as i,t as v,A as P,b as a,d as V,w as N,M as h,e as W,k as q,m as D,X as J,p as L,Q,j as s,n as X}from"#entry";import{a as b,B as C}from"./DJrXkGIA.js";import{B as n}from"./BPW68NmM.js";import{B as O}from"./DMrdB3sj.js";import{u as Y}from"./CBQEV4ZP.js";const Z=w({name:"FilterTabs",components:{BaseIcon:b},props:{modelValue:{type:[Object,String,Number],default:void 0},items:Array,autoselect:{type:Boolean,default:!1}},emits:["update:modelValue"],data(){return{selectedKey:null}},watch:{items(){this.modelValue||this.autoselect&&!this.selectedKey&&this.items?.length&&(this.selectedKey=this.items[0].key)},selectedKey(){this.onSelected(this.selectedKey)}},beforeMount(){this.autoselect&&this.items?.length&&(this.selectedKey=this.items[0].key)},methods:{onSelected(o){this.selectedKey=o,this.$emit("update:modelValue",this.selectedKey)}}}),x={class:"tabs"},_=["id","onClick"],ee={style:{"font-weight":"300"}},le={key:1,class:"error-counter"};function te(o,m,$,U,f,l){const y=P("BaseIcon");return r(),p("section",x,[(r(!0),p(G,null,E(o.items,u=>(r(),p("button",{type:"button",class:I(["tab-button",{selected:o.modelValue===u.key}]),key:u.key,id:`tab-${u.key}`,style:K({background:o.modelValue===u.key&&u.color?u.color:""}),onClick:c=>o.onSelected(u.key)},[u.icon?(r(),R(y,{key:0,name:u.icon,size:"1.2em",style:{"margin-right":".2em",opacity:".8","vertical-align":"baseline"}},null,8,["name"])):B("",!0),i("span",ee,v(u.caption),1),u.badge?(r(),p("div",le,v(u.badge),1)):B("",!0)],14,_))),128))])}const se=Object.assign(T(Z,[["render",te]]),{__name:"CommonBaseTabs"}),ae=w({name:"BaseFilePicker",components:{BaseButton:C,BaseIcon:b},emits:["update:modelValue"],props:{label:String,modelValue:{type:[Object,Array],default:null},error:String,multiple:Boolean},data(){return{selectedFiles:[]}},watch:{modelValue:{immediate:!0,handler(o){this.multiple?this.selectedFiles=Array.isArray(o)?o:o?[o]:[]:this.selectedFiles=o?[o]:[]}}},methods:{openFileDialog(){this.$refs.fileInput.click()},onSelectFile(o){const m=o?.dataTransfer?.files,$=o?.target?.files,U=m?.length?m:$;if(!U||!U.length)return;const f=Array.from(U);this.selectedFiles=this.multiple?f:[f[0]],this.$emit("update:modelValue",this.multiple?[...this.selectedFiles]:this.selectedFiles[0]),o.target&&(o.target.value="")},removeFile(o){this.selectedFiles.splice(o,1),this.multiple?this.$emit("update:modelValue",[...this.selectedFiles]):this.$emit("update:modelValue",null)},getSelectedFiles(){return[...this.selectedFiles]}}}),oe={class:"header",style:{display:"flex","align-items":"start","padding-right":"1em"}},ne={key:0,class:"caption-container",style:{flex:"auto 1 1"}},ie={class:"caption"},me={key:1,class:"error-container",style:{display:"flex",gap:".2em","justify-content":"flex-end","font-size":"14px",color:"red",opacity:".6","line-height":"1.4em"}},ue={class:"error-message"},de={class:"drop-zone"},re={key:0,class:"empty-section"},pe={key:1,class:"preview-section"},Ve={class:"file-list"},fe={class:"file-name"},ye={class:"label-section"},ce=["multiple"];function ge(o,m,$,U,f,l){const y=P("BaseIcon"),u=P("BaseButton");return r(),p("div",{class:I(["file-picker-box",{invalid:o.error}])},[i("header",oe,[o.label?(r(),p("div",ne,[i("span",ie,v(o.label),1)])):B("",!0),o.error?(r(),p("div",me,[a(y,{name:"mdi-alert-decagram",size:"1.2em"}),i("span",ue,v(o.error),1)])):B("",!0)]),i("div",{class:I(["file-picker",{unstored:o.selectedFiles.length>0}]),onDragover:m[1]||(m[1]=h(()=>{},["prevent"])),onDrop:m[2]||(m[2]=h((...c)=>o.onSelectFile&&o.onSelectFile(...c),["prevent"]))},[i("div",de,[o.selectedFiles.length?(r(),p("section",pe,[i("div",Ve,[(r(!0),p(G,null,E(o.selectedFiles,(c,A)=>(r(),p("div",{style:{"font-size":"1.2em",display:"flex","align-items":"center",gap:"0.3em"},class:"file-pill",key:c.name+"-"+c.lastModified},[a(y,{name:"mdi-paperclip",size:"1.1em"}),i("span",fe,v(c.name),1),a(y,{name:"mdi-close-circle",size:"1.1em",style:{cursor:"pointer",opacity:"0.6"},onClick:S=>o.removeFile(A)},null,8,["onClick"])]))),128))])])):(r(),p("section",re,[a(y,{class:"icon",name:o.multiple?"mdi-file-document-multiple-outline":"mdi-file-document-plus-outline"},null,8,["name"])])),i("section",ye,[i("span",null,[V("Перетащите "+v(o.multiple?"файлы":"файл")+" сюда или нажмите ",1),m[3]||(m[3]=i("br",null,null,-1)),m[4]||(m[4]=V(" «Выбрать файл».",-1))])]),a(u,{class:"button",prependIcon:"mdi-plus",onClick:o.openFileDialog,color:"primary"},{default:N(()=>[...m[5]||(m[5]=[i("span",null,"Выбрать файл",-1)])]),_:1},8,["onClick"])]),i("input",{type:"file",multiple:o.multiple,ref:"fileInput",style:{display:"none"},onChange:m[0]||(m[0]=(...c)=>o.onSelectFile&&o.onSelectFile(...c))},null,40,ce)],34)],2)}const k=Object.assign(T(ae,[["render",ge]]),{__name:"CommonBaseFilePicker"}),be={class:"create-issue-page"},ke={class:"forms"},Ue={key:0,style:{display:"flex","justify-content":"center",margin:"1.4em"}},ve={style:{display:"flex","justify-content":"center","margin-top":"1.4em"}},Be={key:2},$e={style:{display:"flex","justify-content":"center","margin-top":"1.4em"}},Fe={key:3,class:"error",style:{"margin-top":"1em",color:"red"}},De=w({__name:"create",setup(o){const{$api:m}=W(),$=q();Y();const U=[{key:"NGV4",caption:"Новая газифиция",icon:"mdi-file-document-plus-outline"},{key:"PRV4",caption:"Перемонтаж",icon:"mdi-file-document-multiple-outline"}],f=D(""),l=J({}),y=D(""),u=D(!1);L(()=>{localStorage.getItem("form")&&(u.value=!0)});function c(){console.log("ss");const g=l.inn;g&&(g.length&&(l.gender=g[0]==="1"?"Ж":"М"),g.length>8&&(l.birthDate=g.slice(1,9).replace(/(\d{2})(\d{2})(\d{4})/,"$3-$2-$1")))}function A(){const g=localStorage.getItem("form");if(!g)return;const e=JSON.parse(g);Object.keys(e).forEach(t=>{l[t]=e[t]})}async function S(){y.value="",localStorage.setItem("form",JSON.stringify(l));const g={},e=$.token;if(!e){console.error("No token");return}const t=new FormData;t.append("key",f.value);const j=["scanOfHousePassport","scanOfSketch","scanOfPassport","scanOfAgreement"],z=["plannedGasUsingDevices","gasConsumptionPattern"];Object.keys(l).forEach(d=>{j.includes(d)||z.includes(d)||t.append(d,l[d])}),j.forEach(d=>{const F=Array.isArray(l[d])?l[d]:[l[d]];for(const H of F)t.append("files",H)});const M=l.plannedGasUsingDevices;l.plannedGasUsingDevices=l.gasConsumptionPattern,l.gasConsumptionPattern=M,z.forEach(d=>{String(l[d]).split(",").forEach(F=>{t.append(d,F)})});try{const d=await m("v1/portal/applications/ngv4",{query:g,method:"POST",headers:{Authorization:`Bearer ${e}`},body:t});console.log(d),X("/issues")}catch(d){const F=d?.data?.message||d?.message||"Не удалось отправить заявку";y.value=F,console.error(d)}}return(g,e)=>(r(),p("section",be,[i("section",ke,[a(se,{modelValue:s(f),"onUpdate:modelValue":e[0]||(e[0]=t=>Q(f)?f.value=t:null),autoselect:"",items:U},null,8,["modelValue"]),s(u)?(r(),p("section",Ue,[a(C,{prependIcon:"mdi-file-document-alert-outline",onClick:A},{default:N(()=>[...e[37]||(e[37]=[V("Применить данные предыдущей заявки",-1)])]),_:1})])):B("",!0),s(f)==="NGV4"?(r(),p("form",{key:1,onSubmit:h(S,["prevent"])},[i("h2",null,[a(b,{name:"mdi-account-outline"}),e[38]||(e[38]=V(" Информация о владельце объекта",-1))]),a(n,{name:"surname",modelValue:s(l).surname,"onUpdate:modelValue":e[1]||(e[1]=t=>s(l).surname=t),label:"Фамилия"},null,8,["modelValue"]),a(n,{name:"name",modelValue:s(l).name,"onUpdate:modelValue":e[2]||(e[2]=t=>s(l).name=t),label:"Имя"},null,8,["modelValue"]),a(n,{name:"lname",modelValue:s(l).lastName,"onUpdate:modelValue":e[3]||(e[3]=t=>s(l).lastName=t),label:"Отчество"},null,8,["modelValue"]),i("h2",null,[a(b,{name:"mdi-office-building-marker-outline"}),e[39]||(e[39]=V(" Информация об объекте газификации",-1))]),a(n,{modelValue:s(l).address,"onUpdate:modelValue":e[4]||(e[4]=t=>s(l).address=t),name:"address",label:"Адрес"},null,8,["modelValue"]),a(k,{multiple:"",modelValue:s(l).scanOfHousePassport,"onUpdate:modelValue":e[5]||(e[5]=t=>s(l).scanOfHousePassport=t),label:"Скан. тех. паспорта на дом"},null,8,["modelValue"]),a(k,{multiple:"",modelValue:s(l).scanOfSketch,"onUpdate:modelValue":e[6]||(e[6]=t=>s(l).scanOfSketch=t),label:"Эскизный чертеж"},null,8,["modelValue"]),a(O,{multiple:"",modelValue:s(l).plannedGasUsingDevices,"onUpdate:modelValue":e[7]||(e[7]=t=>s(l).plannedGasUsingDevices=t),items:[{key:"плита",value:"Плита"},{key:"котел",value:"Котел"},{key:"газовая колонка",value:"Газовая колонка"}],label:"Планируемые газоиспользующие приборы"},null,8,["modelValue"]),a(O,{multiple:"",modelValue:s(l).gasConsumptionPattern,"onUpdate:modelValue":e[8]||(e[8]=t=>s(l).gasConsumptionPattern=t),items:[{key:"отопление",value:"Отопление"},{key:"горячее водоснабжение",value:"Горячее водоснабжение"},{key:"пищеприготовление",value:"Пищеприготовление"}],label:"Характер потребления газа"},null,8,["modelValue"]),i("h2",null,[a(b,{name:"mdi-card-account-details-outline"}),e[40]||(e[40]=V(" Паспортные данные",-1))]),a(n,{onChange:c,name:"tin",mask:"##############",modelValue:s(l).inn,"onUpdate:modelValue":e[9]||(e[9]=t=>s(l).inn=t),label:"ИНН"},null,8,["modelValue"]),a(O,{modelValue:s(l).gender,"onUpdate:modelValue":e[10]||(e[10]=t=>s(l).gender=t),items:[{key:"М",value:"Мужской"},{key:"Ж",value:"Женский"}],label:"Пол"},null,8,["modelValue"]),a(n,{name:"birthdate",modelValue:s(l).birthDate,"onUpdate:modelValue":e[11]||(e[11]=t=>s(l).birthDate=t),type:"date",label:"Дата рождения"},null,8,["modelValue"]),a(n,{name:"passportNum",modelValue:s(l).passportNum,"onUpdate:modelValue":e[12]||(e[12]=t=>s(l).passportNum=t),label:"Номер паспорта"},null,8,["modelValue"]),a(n,{name:"issueDate",modelValue:s(l).passportIssuedDate,"onUpdate:modelValue":e[13]||(e[13]=t=>s(l).passportIssuedDate=t),type:"date",label:"Дата выдачи"},null,8,["modelValue"]),a(n,{name:"issuedBy",modelValue:s(l).passportIssuedBy,"onUpdate:modelValue":e[14]||(e[14]=t=>s(l).passportIssuedBy=t),label:"Орган выдачи"},null,8,["modelValue"]),a(k,{multiple:"",modelValue:s(l).scanOfPassport,"onUpdate:modelValue":e[15]||(e[15]=t=>s(l).scanOfPassport=t),label:"Скан. паспорта с лицевой и обратной стороны"},null,8,["modelValue"]),i("h2",null,[a(b,{name:"mdi-phone-outline"}),e[41]||(e[41]=V(" Контактные данные",-1))]),a(n,{name:"email",modelValue:s(l).email,"onUpdate:modelValue":e[16]||(e[16]=t=>s(l).email=t),label:"Электронный адрес"},null,8,["modelValue"]),a(n,{name:"phone",mask:"996#########",modelValue:s(l).contactNumber,"onUpdate:modelValue":e[17]||(e[17]=t=>s(l).contactNumber=t),label:"Контактный номер"},null,8,["modelValue"]),a(n,{name:"whatsapp",mask:"996#########",modelValue:s(l).whatsAppNumber,"onUpdate:modelValue":e[18]||(e[18]=t=>s(l).whatsAppNumber=t),label:"WhatsApp номер"},null,8,["modelValue"]),a(k,{multiple:"",modelValue:s(l).scanOfAgreement,"onUpdate:modelValue":e[19]||(e[19]=t=>s(l).scanOfAgreement=t),label:"Скан. заявления о согласии на обработку ПД"},null,8,["modelValue"]),i("div",ve,[a(C,{onClick:S,style:{"font-size":"1.2em"},prependIcon:"mdi-content-save"},{default:N(()=>[...e[42]||(e[42]=[V("Сохранить",-1)])]),_:1})])],32)):s(f)==="PRV4"?(r(),p("form",Be,[i("h2",null,[a(b,{name:"mdi-account-outline"}),e[43]||(e[43]=V(" Информация о владельце объекта",-1))]),a(n,{name:"account",modelValue:s(l).account,"onUpdate:modelValue":e[20]||(e[20]=t=>s(l).account=t),label:"Лицевой счет"},null,8,["modelValue"]),a(n,{name:"surname",modelValue:s(l).surname,"onUpdate:modelValue":e[21]||(e[21]=t=>s(l).surname=t),label:"Фамилия"},null,8,["modelValue"]),a(n,{name:"name",modelValue:s(l).name,"onUpdate:modelValue":e[22]||(e[22]=t=>s(l).name=t),label:"Имя"},null,8,["modelValue"]),a(n,{name:"lname",modelValue:s(l).lastName,"onUpdate:modelValue":e[23]||(e[23]=t=>s(l).lastName=t),label:"Отчество"},null,8,["modelValue"]),i("h2",null,[a(b,{name:"mdi-office-building-marker-outline"}),e[44]||(e[44]=V(" Информация об объекте газификации",-1))]),a(k,{multiple:"",modelValue:s(l).scanOfHousePassport,"onUpdate:modelValue":e[24]||(e[24]=t=>s(l).scanOfHousePassport=t),label:"Скан. тех. паспорта на дом"},null,8,["modelValue"]),a(k,{multiple:"",modelValue:s(l).scanOfSketch,"onUpdate:modelValue":e[25]||(e[25]=t=>s(l).scanOfSketch=t),label:"Эскизный чертеж"},null,8,["modelValue"]),i("h2",null,[a(b,{name:"mdi-card-account-details-outline"}),e[45]||(e[45]=V(" Паспортные данные",-1))]),a(n,{onChange:c,name:"tin",modelValue:s(l).inn,"onUpdate:modelValue":e[26]||(e[26]=t=>s(l).inn=t),label:"ИНН"},null,8,["modelValue"]),a(O,{modelValue:s(l).gender,"onUpdate:modelValue":e[27]||(e[27]=t=>s(l).gender=t),items:[{key:"М",value:"Мужской"},{key:"Ж",value:"Женский"}],label:"Пол"},null,8,["modelValue"]),a(n,{name:"birthdate",modelValue:s(l).birthDate,"onUpdate:modelValue":e[28]||(e[28]=t=>s(l).birthDate=t),type:"date",label:"Дата рождения"},null,8,["modelValue"]),a(n,{name:"passportNum",modelValue:s(l).passportNum,"onUpdate:modelValue":e[29]||(e[29]=t=>s(l).passportNum=t),label:"Номер паспорта"},null,8,["modelValue"]),a(n,{name:"issueDate",modelValue:s(l).passportIssuedDate,"onUpdate:modelValue":e[30]||(e[30]=t=>s(l).passportIssuedDate=t),type:"date",label:"Дата выдачи"},null,8,["modelValue"]),a(n,{name:"issuedBy",modelValue:s(l).passportIssuedBy,"onUpdate:modelValue":e[31]||(e[31]=t=>s(l).passportIssuedBy=t),label:"Орган выдачи"},null,8,["modelValue"]),a(k,{multiple:"",modelValue:s(l).scanOfPassport,"onUpdate:modelValue":e[32]||(e[32]=t=>s(l).scanOfPassport=t),label:"Скан. паспорта с лицевой и обратной стороны"},null,8,["modelValue"]),i("h2",null,[a(b,{name:"mdi-phone-outline"}),e[46]||(e[46]=V(" Контактные данные",-1))]),a(n,{name:"email",modelValue:s(l).email,"onUpdate:modelValue":e[33]||(e[33]=t=>s(l).email=t),label:"Электронный адрес"},null,8,["modelValue"]),a(n,{name:"phone",mask:"+996(###)### ###",modelValue:s(l).contactNumber,"onUpdate:modelValue":e[34]||(e[34]=t=>s(l).contactNumber=t),label:"Контактный номер"},null,8,["modelValue"]),a(n,{name:"whatsapp",mask:"+996(###)### ###",modelValue:s(l).whatsAppNumber,"onUpdate:modelValue":e[35]||(e[35]=t=>s(l).whatsAppNumber=t),label:"WhatsApp номер"},null,8,["modelValue"]),a(k,{multiple:"",modelValue:s(l).scanOfAgreement,"onUpdate:modelValue":e[36]||(e[36]=t=>s(l).scanOfAgreement=t),label:"Скан. заявления о согласии на обработку ПД"},null,8,["modelValue"]),i("div",$e,[a(C,{onClick:S,style:{"font-size":"1.2em"},prependIcon:"mdi-content-save"},{default:N(()=>[...e[47]||(e[47]=[V("Сохранить",-1)])]),_:1})])])):B("",!0),s(y)?(r(),p("div",Fe,v(s(y)),1)):B("",!0)])]))}});export{De as default};
