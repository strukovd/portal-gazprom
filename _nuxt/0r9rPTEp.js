import{a as f}from"./-_DaJmk0.js";import{g,_ as I,c as o,o as l,a as r,O as a,t as d,W as y,d as w,b as V,F as m,r as c,a0 as v,T as h,A as S}from"#entry";const b=g({name:"BaseAutocomplete",emits:["update:modelValue","change"],components:{BaseIcon:f},props:{modelValue:[String,Number,Array],label:String,placeholder:String,appendIcon:String,items:Array,autoselect:Boolean,multiple:Boolean,showKey:Boolean,loading:Boolean,error:String,fieldKey:{type:String,default:"key"},fieldValue:{type:String,default:"value"},emitValue:{type:Boolean,default:!1}},data(){return{searchValue:"",focused:!1,visibleDropdown:!1,focusedItem:-1,selectedItems:[]}},computed:{filteredItems(){if(this.items)if(this.multiple){const e=this.items?.filter(t=>{const s=String(t[this.fieldKey]).toLowerCase(),n=String(t[this.fieldValue]).toLowerCase();return s.includes(this.searchValue.toLowerCase())||n.includes(this.searchValue.toLowerCase())});if(this.selectedItems.length){const t=this.selectedItems.map(s=>String(s[this.fieldKey]));return e.filter(s=>!t.includes(String(s[this.fieldKey])))}return e}else if(this.selectedItems.length){const e=this.selectedItems.map(t=>String(t[this.fieldKey]));return this.items.filter(t=>!e.includes(String(t[this.fieldKey])))}else return this.items?.filter(t=>{const s=String(t[this.fieldKey]).toLowerCase(),n=String(t[this.fieldValue]).toLowerCase();return s.includes(this.searchValue.toLowerCase())||n.includes(this.searchValue.toLowerCase())});return[]}},methods:{getEmitField(){return this.emitValue?this.fieldValue:this.fieldKey},selectItem(e){if(e){let t;const s=this.getEmitField();this.multiple?(this.searchValue="",this.selectedItems.push(e),t=this.selectedItems.map(n=>String(n[s]))):(this.searchValue=e[this.fieldValue],this.selectedItems=[e],t=e[s]),this.$emit("update:modelValue",t),this.$emit("change",t),this.hideDropdown()}},resetItems(){this.searchValue="",this.selectedItems=[],this.$emit("update:modelValue",void 0),this.$emit("change",void 0)},showDropdown(){this.visibleDropdown=!0},hideDropdown(){setTimeout(()=>{this.visibleDropdown=!1},10)},onInput(){this.showDropdown(),!this.multiple&&this.selectedItems.length&&this.selectedItems.pop()},onKeydown(e){switch(e.keyCode){case 9:case 13:this.filteredItems?.length&&this.visibleDropdown&&(this.selectItem(this.filteredItems[this.focusedItem]),e.stopPropagation(),e.preventDefault());break;case 27:this.visibleDropdown&&(this.hideDropdown(),e.stopPropagation());break;case 8:this.searchValue===""&&(e.ctrlKey?this.selectedItems=[]:this.selectedItems.pop());break;case 38:if(this.filteredItems){if(!this.visibleDropdown){this.showDropdown();return}--this.focusedItem<0&&(this.focusedItem=this.filteredItems?.length-1)}break;case 40:if(this.filteredItems){if(!this.visibleDropdown){this.showDropdown();return}++this.focusedItem>=this.filteredItems?.length&&(this.focusedItem=0)}break}},onFocusOrBlur(e){e?this.showDropdown():this.hideDropdown(),this.focused=e},init(){if(this.modelValue){const e=this.getEmitField();if(this.multiple&&Array.isArray(this.modelValue)){const t=this.modelValue.map(s=>this.items?.find(n=>String(n[e])===String(s))).filter(Boolean);if(t.length){this.searchValue="",this.selectedItems=t;const s=t.map(n=>String(n[e]));this.$emit("update:modelValue",s)}}else{const t=this.items?.find(s=>String(s[e])===String(this.modelValue));t&&this.selectItem(t)}}else this.autoselect&&this.items?.length&&this.selectItem(this.items[0])}},watch:{items(e,t){JSON.stringify(e)!==JSON.stringify(t)&&this.init()}},created(){this.init()},unmounted(){this.$emit("update:modelValue",void 0)}}),K={class:"header",style:{display:"flex","align-items":"start","padding-right":"1em"}},B={key:0,class:"caption-container",style:{flex:"auto 1 1"}},D={class:"caption"},k={key:1,class:"error-container",style:{display:"flex",gap:".2em","justify-content":"flex-end","font-size":"14px",color:"red",opacity:".6","line-height":"1.4em"}},C={class:"error-message"},$={class:"input-container"},F={key:0,class:"selected-items"},L=["placeholder"],A={key:1,class:"loader"},N={key:0,class:"dropdown"},O=["onMousedown"],E={key:0,style:{opacity:".3","margin-left":".3em"}},T={class:"dropdown-item"},z={key:0};function M(e,t,s,n,j,J){const p=S("BaseIcon");return l(),o("div",{class:h(["base-autocomplete-wrapper",{invalid:e.error}])},[r("label",null,[r("header",K,[e.label?(l(),o("div",B,[r("span",D,d(e.label),1)])):a("",!0),e.error?(l(),o("div",k,[r("span",C,d(e.error),1)])):a("",!0)]),r("div",$,[e.multiple&&e.selectedItems.length?(l(),o("span",F,[(l(!0),o(m,null,c(e.selectedItems,i=>(l(),o("span",{class:"item-badge",key:i[e.fieldKey]},[r("span",null,d(i[e.fieldValue]),1)]))),128))])):a("",!0),y(r("input",{type:"text",placeholder:e.placeholder,class:h({selected:e.selectedItems.length}),"onUpdate:modelValue":t[0]||(t[0]=i=>e.searchValue=i),onFocus:t[1]||(t[1]=i=>e.onFocusOrBlur(!0)),onBlur:t[2]||(t[2]=i=>e.onFocusOrBlur(!1)),onInput:t[3]||(t[3]=(...i)=>e.onInput&&e.onInput(...i)),onKeydown:t[4]||(t[4]=(...i)=>e.onKeydown&&e.onKeydown(...i))},null,42,L),[[v,e.searchValue]]),w(" "+d(e.appendIcon)+" ",1),V(p,{class:"append-icon",size:"1.4em",name:e.appendIcon??"mdi-menu-down"},null,8,["name"]),e.loading?(l(),o("div",A)):a("",!0)])]),e.visibleDropdown?(l(),o("ul",N,[(l(!0),o(m,null,c(e.filteredItems,(i,u)=>(l(),o("li",{key:u,class:h(["dropdown-item",{focusedItem:e.focusedItem===u}]),onMousedown:P=>e.selectItem(i)},[r("span",null,[r("span",null,d(i[e.fieldValue]),1),e.showKey?(l(),o("span",E,d(i[e.fieldKey]),1)):a("",!0)])],42,O))),128)),r("li",T,[e.filteredItems?.length===0?(l(),o("span",z,"Ничего не найдено")):a("",!0)])])):a("",!0)],2)}const q=Object.assign(I(b,[["render",M]]),{__name:"CommonBaseAutocomplete"});export{q as B};
