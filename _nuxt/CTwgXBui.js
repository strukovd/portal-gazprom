import{g as w,_ as M,c as V,o as r,F as H,r as x,S as K,T as A,U as R,O as c,a as n,t as v,A as j,b as o,d as p,w as $,M as z,e as W,k as h,m as D,V as q,p as J,Q as L,j as s,W as I,X as P,n as Q}from"#entry";import{a as b,B as S}from"./-_DaJmk0.js";import{B as i}from"./BfTX90vv.js";import{B as F}from"./0r9rPTEp.js";import{u as X}from"./CBQEV4ZP.js";const Y=w({name:"FilterTabs",components:{BaseIcon:b},props:{modelValue:{type:[Object,String,Number],default:void 0},items:Array,autoselect:{type:Boolean,default:!1}},emits:["update:modelValue"],data(){return{selectedKey:null}},watch:{items(){this.modelValue||this.autoselect&&!this.selectedKey&&this.items?.length&&(this.selectedKey=this.items[0].key)},selectedKey(){this.onSelected(this.selectedKey)}},beforeMount(){this.autoselect&&this.items?.length&&(this.selectedKey=this.items[0].key)},methods:{onSelected(a){this.selectedKey=a,this.$emit("update:modelValue",this.selectedKey)}}}),Z={class:"tabs"},_=["id","onClick"],ee={style:{"font-weight":"300"}},le={key:1,class:"error-counter"};function te(a,u,k,N,g,t){const f=j("BaseIcon");return r(),V("section",Z,[(r(!0),V(H,null,x(a.items,m=>(r(),V("button",{type:"button",class:A(["tab-button",{selected:a.modelValue===m.key}]),key:m.key,id:`tab-${m.key}`,style:K({background:a.modelValue===m.key&&m.color?m.color:""}),onClick:y=>a.onSelected(m.key)},[m.icon?(r(),R(f,{key:0,name:m.icon,size:"1.2em",style:{"margin-right":".2em",opacity:".8","vertical-align":"baseline"}},null,8,["name"])):c("",!0),n("span",ee,v(m.caption),1),m.badge?(r(),V("div",le,v(m.badge),1)):c("",!0)],14,_))),128))])}const se=Object.assign(M(Y,[["render",te]]),{__name:"CommonBaseTabs"}),oe=w({name:"BaseFilePicker",components:{BaseButton:S,BaseIcon:b},emits:["update:modelValue"],props:{label:String,src:String,modelValue:Object,error:String,multiple:Boolean},watch:{src(a,u){this.storedFile=a},modelValue(a,u){this.multiple?this.selectedFiles=Array.isArray(a)?a:a?[a]:[]:this.selectedFiles=a?[a]:[]}},data(){return{storedFile:null,selectedFiles:[]}},methods:{onClick(a){this.$refs.fileInput.click()},onSelectFile(a){const u=a?.dataTransfer?.files||a?.target?.files;console.log(u,this.multiple);const k=u?Array.from(u):[];k.length&&(this.selectedFiles=this.multiple?k:[k[0]],this.$emit("update:modelValue",this.multiple?this.selectedFiles:this.selectedFiles[0]))},getSelectedFile(){return this.multiple?this.selectedFiles:this.selectedFiles[0]}},created(){this.src&&(this.storedFile=this.src)}}),ae={class:"header",style:{display:"flex","align-items":"start","padding-right":"1em"}},ne={key:0,class:"caption-container",style:{flex:"auto 1 1"}},ie={class:"caption"},ue={key:1,class:"error-container",style:{display:"flex",gap:".2em","justify-content":"flex-end","font-size":"14px",color:"red",opacity:".6","line-height":"1.4em"}},de={class:"error-message"},me={class:"drop-zone"},re={key:0,class:"empty-section"},pe={key:1,class:"preview-section"},Ve={class:"file-list"},fe={class:"file-name"},ye={class:"label-section"},be=["multiple"];function ge(a,u,k,N,g,t){const f=j("BaseIcon"),m=j("BaseButton");return r(),V("div",{class:A(["file-picker-box",{invalid:a.error}])},[n("header",ae,[a.label?(r(),V("div",ne,[n("span",ie,v(a.label),1)])):c("",!0),a.error?(r(),V("div",ue,[o(f,{name:"mdi-alert-decagram",size:"1.2em"}),n("span",de,v(a.error),1)])):c("",!0)]),n("div",{class:A(["file-picker",{unstored:a.selectedFiles.length}]),onDragover:u[1]||(u[1]=z(()=>{},["prevent"])),onDrop:u[2]||(u[2]=z((...y)=>a.onSelectFile&&a.onSelectFile(...y),["prevent"]))},[n("div",me,[a.selectedFiles.length?(r(),V("section",pe,[n("div",Ve,[(r(!0),V(H,null,x(a.selectedFiles,y=>(r(),V("div",{style:{"font-size":"1.2em"},class:"file-pill",key:y.name+y.size},[o(f,{name:"mdi-paperclip",size:"1.1em"}),n("span",fe,v(y.name),1)]))),128))])])):(r(),V("section",re,[o(f,{class:"icon",name:a.multiple?"mdi-file-document-multiple-outline":"mdi-file-document-plus-outline"},null,8,["name"])])),n("section",ye,[n("span",null,[p("Перетащите "+v(a.multiple?"файлы":"файл")+" сюда или нажмите ",1),u[3]||(u[3]=n("br",null,null,-1)),u[4]||(u[4]=p(" «Выбрать файл».",-1))])]),o(m,{class:"button",prependIcon:"mdi-plus",onClick:a.onClick,color:"primary"},{default:$(()=>[...u[5]||(u[5]=[n("span",null,"Выбрать файл",-1)])]),_:1},8,["onClick"])]),n("input",{type:"file",multiple:a.multiple,ref:"fileInput",style:{display:"none"},onChange:u[0]||(u[0]=(...y)=>a.onSelectFile&&a.onSelectFile(...y))},null,40,be)],34)],2)}const U=Object.assign(M(oe,[["render",ge]]),{__name:"CommonBaseFilePicker"}),ke={class:"create-issue-page"},ve={class:"forms"},ce={key:0,style:{display:"flex","justify-content":"center",margin:"1.4em"}},Ue={style:{display:"flex","justify-content":"center","margin-top":"1.4em"}},Be={key:2},Fe={style:{display:"flex","justify-content":"center","margin-top":"1.4em"}},$e={key:3,class:"error",style:{"margin-top":"1em",color:"red"}},Ie=w({__name:"create",setup(a){const{$api:u}=W(),k=h();X();const N=[{key:"NGV4",caption:"Новая газифиция",icon:"mdi-file-document-plus-outline"},{key:"PRV4",caption:"Перемонтаж",icon:"mdi-file-document-multiple-outline"}],g=D(""),t=q({}),f=D(""),m=D(!1);J(()=>{localStorage.getItem("form")&&(m.value=!0)});function y(){const B=localStorage.getItem("form");if(!B)return;const e=JSON.parse(B);Object.keys(e).forEach(l=>{t[l]=e[l]})}async function O(){localStorage.setItem("form",JSON.stringify(t));const B={},e=k.token;if(!e){console.error("No token");return}const l=new FormData;l.append("key",g.value);const T=["scanOfHousePassport"],E=["plannedGasUsingDevices","gasConsumptionPattern"],G=["birthDate","passportIssuedDate"];Object.keys(t).forEach(d=>{T.includes(d)||E.includes(d)||G.includes(d)||l.append(d,t[d])}),E.forEach(d=>{String(t[d]).split(",").forEach(C=>{l.append(d,C)})}),T.forEach(d=>{l.append("files",t[d])}),G.forEach(d=>{l.append(d,String(t[d]).replace(/(\d{4})\-(\d{2})\-(\d{2})/g,"$3-$2-$1"))});try{f.value="";const d=await u("v1/applications",{query:B,method:"POST",headers:{Authorization:`Bearer ${e}`},body:l});console.log(d)}catch(d){const C=d?.data?.message||d?.message||"Не удалось отправить заявку";f.value=C,console.error(d)}Q("/issues")}return(B,e)=>(r(),V("section",ke,[n("section",ve,[o(se,{modelValue:s(g),"onUpdate:modelValue":e[0]||(e[0]=l=>L(g)?g.value=l:null),autoselect:"",items:N},null,8,["modelValue"]),s(m)?(r(),V("section",ce,[o(S,{prependIcon:"mdi-file-document-alert-outline",onClick:y},{default:$(()=>[...e[38]||(e[38]=[p("Применить данные предыдущей заявки",-1)])]),_:1})])):c("",!0),s(g)==="NGV4"?(r(),V("form",{key:1,onSubmit:z(O,["prevent"])},[n("h2",null,[o(b,{name:"mdi-account-outline"}),e[39]||(e[39]=p(" Информация о владельце объекта",-1))]),o(i,{name:"surname",modelValue:s(t).surname,"onUpdate:modelValue":e[1]||(e[1]=l=>s(t).surname=l),label:"Фамилия"},null,8,["modelValue"]),o(i,{name:"name",modelValue:s(t).name,"onUpdate:modelValue":e[2]||(e[2]=l=>s(t).name=l),label:"Имя"},null,8,["modelValue"]),o(i,{name:"lname",modelValue:s(t).lname,"onUpdate:modelValue":e[3]||(e[3]=l=>s(t).lname=l),label:"Отчество"},null,8,["modelValue"]),n("h2",null,[o(b,{name:"mdi-office-building-marker-outline"}),e[40]||(e[40]=p(" Информация об объекте газификации",-1))]),o(i,{modelValue:s(t).addressOfGasification,"onUpdate:modelValue":e[4]||(e[4]=l=>s(t).addressOfGasification=l),name:"address",label:"Адрес"},null,8,["modelValue"]),o(U,{modelValue:s(t).scanOfHousePassport,"onUpdate:modelValue":e[5]||(e[5]=l=>s(t).scanOfHousePassport=l),label:"Скан. тех. паспорта на дом"},null,8,["modelValue"]),o(F,{multiple:"",modelValue:s(t).plannedGasUsingDevices,"onUpdate:modelValue":e[6]||(e[6]=l=>s(t).plannedGasUsingDevices=l),items:[{key:"плита",value:"Плита"},{key:"котел",value:"Котел"},{key:"газовая колонка",value:"Газовая колонка"}],label:"Планируемые газоиспользующие приборы"},null,8,["modelValue"]),o(F,{multiple:"",modelValue:s(t).gasConsumptionPattern,"onUpdate:modelValue":e[7]||(e[7]=l=>s(t).gasConsumptionPattern=l),items:[{key:"отопление",value:"Отопление"},{key:"горячее водоснабжение",value:"Горячее водоснабжение"},{key:"пищеприготовление",value:"Пищеприготовление"}],label:"Характер потребления газа"},null,8,["modelValue"]),n("h2",null,[o(b,{name:"mdi-card-account-details-outline"}),e[41]||(e[41]=p(" Паспортные данные",-1))]),o(i,{name:"tin",mask:"##############",modelValue:s(t).inn,"onUpdate:modelValue":e[8]||(e[8]=l=>s(t).inn=l),label:"ИНН"},null,8,["modelValue"]),o(F,{modelValue:s(t).gender,"onUpdate:modelValue":e[9]||(e[9]=l=>s(t).gender=l),items:[{key:"М",value:"Мужской"},{key:"Ж",value:"Женский"}],label:"Пол"},null,8,["modelValue"]),o(i,{name:"birthdate",modelValue:s(t).birthDate,"onUpdate:modelValue":e[10]||(e[10]=l=>s(t).birthDate=l),type:"date",label:"Дата рождения"},null,8,["modelValue"]),o(i,{name:"passportNum",modelValue:s(t).passportNum,"onUpdate:modelValue":e[11]||(e[11]=l=>s(t).passportNum=l),label:"Номер паспорта"},null,8,["modelValue"]),o(i,{name:"issueDate",modelValue:s(t).passportIssuedDate,"onUpdate:modelValue":e[12]||(e[12]=l=>s(t).passportIssuedDate=l),type:"date",label:"Дата выдачи"},null,8,["modelValue"]),o(i,{name:"issuedBy",modelValue:s(t).passportIssuedBy,"onUpdate:modelValue":e[13]||(e[13]=l=>s(t).passportIssuedBy=l),label:"Орган выдачи"},null,8,["modelValue"]),o(U,{modelValue:s(t).scanOfPassport,"onUpdate:modelValue":e[14]||(e[14]=l=>s(t).scanOfPassport=l),multiple:"",label:"Скан. паспорта с лицевой и обратной стороны"},null,8,["modelValue"]),n("h2",null,[o(b,{name:"mdi-phone-outline"}),e[42]||(e[42]=p(" Контактные данные",-1))]),o(i,{name:"email",modelValue:s(t).email,"onUpdate:modelValue":e[15]||(e[15]=l=>s(t).email=l),label:"Электронный адрес"},null,8,["modelValue"]),o(i,{name:"phone",mask:"+996#########",modelValue:s(t).contactNumber,"onUpdate:modelValue":e[16]||(e[16]=l=>s(t).contactNumber=l),label:"Контактный номер"},null,8,["modelValue"]),o(i,{name:"whatsapp",mask:"+996#########",modelValue:s(t).whatsappNumber,"onUpdate:modelValue":e[17]||(e[17]=l=>s(t).whatsappNumber=l),label:"WhatsApp номер"},null,8,["modelValue"]),o(U,{modelValue:s(t).scanOfAgreement,"onUpdate:modelValue":e[18]||(e[18]=l=>s(t).scanOfAgreement=l),label:"Скан. заявления о согласии на обработку ПД"},null,8,["modelValue"]),n("div",null,[n("label",null,[I(n("input",{"onUpdate:modelValue":e[19]||(e[19]=l=>s(t).agreement=l),type:"checkbox"},null,512),[[P,s(t).agreement]]),e[43]||(e[43]=p()),e[44]||(e[44]=n("span",null,"Согласие на обработку персональных данных",-1))])]),n("div",Ue,[o(S,{onClick:O,style:{"font-size":"1.2em"},prependIcon:"mdi-content-save"},{default:$(()=>[...e[45]||(e[45]=[p("Сохранить",-1)])]),_:1})])],32)):s(g)==="PRV4"?(r(),V("form",Be,[n("h2",null,[o(b,{name:"mdi-account-outline"}),e[46]||(e[46]=p(" Информация о владельце объекта",-1))]),o(i,{name:"account",modelValue:s(t).account,"onUpdate:modelValue":e[20]||(e[20]=l=>s(t).account=l),label:"Лицевой счет"},null,8,["modelValue"]),o(i,{name:"surname",modelValue:s(t).surname,"onUpdate:modelValue":e[21]||(e[21]=l=>s(t).surname=l),label:"Фамилия"},null,8,["modelValue"]),o(i,{name:"name",modelValue:s(t).name,"onUpdate:modelValue":e[22]||(e[22]=l=>s(t).name=l),label:"Имя"},null,8,["modelValue"]),o(i,{name:"lname",modelValue:s(t).lname,"onUpdate:modelValue":e[23]||(e[23]=l=>s(t).lname=l),label:"Отчество"},null,8,["modelValue"]),n("h2",null,[o(b,{name:"mdi-office-building-marker-outline"}),e[47]||(e[47]=p(" Информация об объекте газификации",-1))]),o(U,{modelValue:s(t).scanOfHousePassport,"onUpdate:modelValue":e[24]||(e[24]=l=>s(t).scanOfHousePassport=l),label:"Скан. тех. паспорта на дом"},null,8,["modelValue"]),n("h2",null,[o(b,{name:"mdi-card-account-details-outline"}),e[48]||(e[48]=p(" Паспортные данные",-1))]),o(i,{name:"tin",modelValue:s(t).inn,"onUpdate:modelValue":e[25]||(e[25]=l=>s(t).inn=l),label:"ИНН"},null,8,["modelValue"]),o(F,{modelValue:s(t).gender,"onUpdate:modelValue":e[26]||(e[26]=l=>s(t).gender=l),items:[{key:"М",value:"Мужской"},{key:"Ж",value:"Женский"}],label:"Пол"},null,8,["modelValue"]),o(i,{name:"birthdate",modelValue:s(t).birthDate,"onUpdate:modelValue":e[27]||(e[27]=l=>s(t).birthDate=l),type:"date",label:"Дата рождения"},null,8,["modelValue"]),o(i,{name:"passportNum",modelValue:s(t).passportNum,"onUpdate:modelValue":e[28]||(e[28]=l=>s(t).passportNum=l),label:"Номер паспорта"},null,8,["modelValue"]),o(i,{name:"issueDate",modelValue:s(t).passportIssuedDate,"onUpdate:modelValue":e[29]||(e[29]=l=>s(t).passportIssuedDate=l),type:"date",label:"Дата выдачи"},null,8,["modelValue"]),o(i,{name:"issuedBy",modelValue:s(t).passportIssuedBy,"onUpdate:modelValue":e[30]||(e[30]=l=>s(t).passportIssuedBy=l),label:"Орган выдачи"},null,8,["modelValue"]),o(U,{modelValue:s(t).scanOfPassport,"onUpdate:modelValue":e[31]||(e[31]=l=>s(t).scanOfPassport=l),multiple:"",label:"Скан. паспорта с лицевой и обратной стороны"},null,8,["modelValue"]),n("h2",null,[o(b,{name:"mdi-phone-outline"}),e[49]||(e[49]=p(" Контактные данные",-1))]),o(i,{name:"email",modelValue:s(t).email,"onUpdate:modelValue":e[32]||(e[32]=l=>s(t).email=l),label:"Электронный адрес"},null,8,["modelValue"]),o(i,{name:"phone",mask:"+996(###)### ###",modelValue:s(t).contactNumber,"onUpdate:modelValue":e[33]||(e[33]=l=>s(t).contactNumber=l),label:"Контактный номер"},null,8,["modelValue"]),o(i,{name:"whatsapp",mask:"+996(###)### ###",modelValue:s(t).whatsappNumber,"onUpdate:modelValue":e[34]||(e[34]=l=>s(t).whatsappNumber=l),label:"WhatsApp номер"},null,8,["modelValue"]),o(U,{modelValue:s(t).scanOfAgreement,"onUpdate:modelValue":e[35]||(e[35]=l=>s(t).scanOfAgreement=l),label:"Скан. заявления о согласии на обработку ПД"},null,8,["modelValue"]),n("div",null,[n("label",null,[I(n("input",{"onUpdate:modelValue":e[36]||(e[36]=l=>s(t).agreement=l),type:"checkbox"},null,512),[[P,s(t).agreement]]),e[50]||(e[50]=p()),e[51]||(e[51]=n("span",null,"Согласие на обработку персональных данных",-1))])]),n("div",null,[n("label",null,[I(n("input",{"onUpdate:modelValue":e[37]||(e[37]=l=>s(t).updateData=l),type:"checkbox"},null,512),[[P,s(t).updateData]]),e[52]||(e[52]=p()),e[53]||(e[53]=n("span",null,"Обновить данные абонента",-1))])]),n("div",Fe,[o(S,{onClick:O,style:{"font-size":"1.2em"},prependIcon:"mdi-content-save"},{default:$(()=>[...e[54]||(e[54]=[p("Сохранить",-1)])]),_:1})])])):c("",!0),s(f)?(r(),V("div",$e,v(s(f)),1)):c("",!0)])]))}});export{Ie as default};
