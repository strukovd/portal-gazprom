import{g as j,_ as E,c as r,o as u,F as H,r as K,U as q,W as h,T as J,O as k,a as n,t as v,A as w,b as a,d as p,w as S,M as z,e as L,k as Q,m as F,X,p as Y,j as s,Q as Z,n as M}from"#entry";import{a as g,B as O}from"./DJrXkGIA.js";import{B as i}from"./BPW68NmM.js";import{B as C}from"./B-s4ZqkC.js";import{u as x}from"./BRjPVNtu.js";const _=j({name:"FilterTabs",components:{BaseIcon:g},props:{modelValue:{type:[Object,String,Number],default:void 0},items:Array,autoselect:{type:Boolean,default:!1}},emits:["update:modelValue"],data(){return{selectedKey:null}},watch:{items(){this.modelValue||this.autoselect&&!this.selectedKey&&this.items?.length&&(this.selectedKey=this.items[0].key)},selectedKey(){this.onSelected(this.selectedKey)}},beforeMount(){this.autoselect&&this.items?.length&&(this.selectedKey=this.items[0].key)},methods:{onSelected(o){this.selectedKey=o,this.$emit("update:modelValue",this.selectedKey)}}}),ee={class:"tabs"},le=["id","onClick"],te={style:{"font-weight":"300"}},se={key:1,class:"error-counter"};function ae(o,m,B,c,U,I){const V=w("BaseIcon");return u(),r("section",ee,[(u(!0),r(H,null,K(o.items,l=>(u(),r("button",{type:"button",class:h(["tab-button",{selected:o.modelValue===l.key}]),key:l.key,id:`tab-${l.key}`,style:q({background:o.modelValue===l.key&&l.color?l.color:""}),onClick:f=>o.onSelected(l.key)},[l.icon?(u(),J(V,{key:0,name:l.icon,size:"1.2em",style:{"margin-right":".2em",opacity:".8","vertical-align":"baseline"}},null,8,["name"])):k("",!0),n("span",te,v(l.caption),1),l.badge?(u(),r("div",se,v(l.badge),1)):k("",!0)],14,le))),128))])}const oe=Object.assign(E(_,[["render",ae]]),{__name:"CommonBaseTabs"}),ne=j({name:"BaseFilePicker",components:{BaseButton:O,BaseIcon:g},emits:["update:modelValue"],props:{label:String,modelValue:{type:[Object,Array],default:null},error:String,multiple:Boolean},data(){return{selectedFiles:[]}},watch:{modelValue:{immediate:!0,handler(o){this.multiple?this.selectedFiles=Array.isArray(o)?o:o?[o]:[]:this.selectedFiles=o?[o]:[]}}},methods:{openFileDialog(){this.$refs.fileInput.click()},onSelectFile(o){const m=o?.dataTransfer?.files,B=o?.target?.files,c=m?.length?m:B;if(!c||!c.length)return;const U=Array.from(c);this.selectedFiles=this.multiple?U:[U[0]],this.$emit("update:modelValue",this.multiple?[...this.selectedFiles]:this.selectedFiles[0]),o.target&&(o.target.value="")},removeFile(o){this.selectedFiles.splice(o,1),this.multiple?this.$emit("update:modelValue",[...this.selectedFiles]):this.$emit("update:modelValue",null)},getSelectedFiles(){return[...this.selectedFiles]}}}),ie={class:"header",style:{display:"flex","align-items":"start","padding-right":"1em"}},me={key:0,class:"caption-container",style:{flex:"auto 1 1"}},ue={class:"caption"},de={key:1,class:"error-container",style:{display:"flex",gap:".2em","justify-content":"flex-end","font-size":"14px",color:"red",opacity:".6","line-height":"1.4em"}},re={class:"error-message"},pe={class:"drop-zone"},Ve={key:0,class:"empty-section"},fe={key:1,class:"preview-section"},ye={class:"file-list"},ge={class:"file-name"},ce={class:"label-section"},be=["multiple"];function ke(o,m,B,c,U,I){const V=w("BaseIcon"),l=w("BaseButton");return u(),r("div",{class:h(["file-picker-box",{invalid:o.error}])},[n("header",ie,[o.label?(u(),r("div",me,[n("span",ue,v(o.label),1)])):k("",!0),o.error?(u(),r("div",de,[a(V,{name:"mdi-alert-decagram",size:"1.2em"}),n("span",re,v(o.error),1)])):k("",!0)]),n("div",{class:h(["file-picker",{unstored:o.selectedFiles.length>0}]),onDragover:m[1]||(m[1]=z(()=>{},["prevent"])),onDrop:m[2]||(m[2]=z((...f)=>o.onSelectFile&&o.onSelectFile(...f),["prevent"]))},[n("div",pe,[o.selectedFiles.length?(u(),r("section",fe,[n("div",ye,[(u(!0),r(H,null,K(o.selectedFiles,(f,N)=>(u(),r("div",{style:{"font-size":"1.2em",display:"flex","align-items":"center",gap:"0.3em"},class:"file-pill",key:f.name+"-"+f.lastModified},[a(V,{name:"mdi-paperclip",size:"1.1em"}),n("span",ge,v(f.name),1),a(V,{name:"mdi-close-circle",size:"1.1em",style:{cursor:"pointer",opacity:"0.6"},onClick:A=>o.removeFile(N)},null,8,["onClick"])]))),128))])])):(u(),r("section",Ve,[a(V,{class:"icon",name:o.multiple?"mdi-file-document-multiple-outline":"mdi-file-document-plus-outline"},null,8,["name"])])),n("section",ce,[n("span",null,[p("Перетащите "+v(o.multiple?"файлы":"файл")+" сюда или нажмите ",1),m[3]||(m[3]=n("br",null,null,-1)),m[4]||(m[4]=p(" «Выбрать файл».",-1))])]),a(l,{class:"button",prependIcon:"mdi-plus",onClick:o.openFileDialog,color:"primary"},{default:S(()=>[...m[5]||(m[5]=[n("span",null,"Выбрать файл",-1)])]),_:1},8,["onClick"])]),n("input",{type:"file",multiple:o.multiple,ref:"fileInput",style:{display:"none"},onChange:m[0]||(m[0]=(...f)=>o.onSelectFile&&o.onSelectFile(...f))},null,40,be)],34)],2)}const b=Object.assign(E(ne,[["render",ke]]),{__name:"CommonBaseFilePicker"}),ve=globalThis.setInterval,Ue={class:"create-issue-page"},$e={key:0,class:"msg"},Be={style:{"vertical-align":"middle","font-size":".7em"}},Fe={class:"forms"},Se={key:0,style:{display:"flex","justify-content":"center",margin:"1.4em"}},Oe={style:{display:"flex","justify-content":"center","margin-top":"1.4em"}},Ne={key:2},Ce={style:{display:"flex","justify-content":"center","margin-top":"1.4em"}},Ie={key:3,class:"error",style:{"margin-top":"1em",color:"red"}},ze=j({__name:"create",setup(o){const{$api:m}=L(),B=Q();x();const c=F(10),U=F(!1),I=[{key:"NGV4",caption:"Новая газифиция",icon:"mdi-file-document-plus-outline"},{key:"PRV4",caption:"Перемонтаж",icon:"mdi-file-document-multiple-outline"}],V=F(""),l=X({}),f=F(""),N=F(!1);Y(()=>{localStorage.getItem("form")&&(N.value=!0)});function A(){console.log("ss");const y=l.inn;y&&(y.length&&(l.gender=y[0]==="1"?"Ж":"М"),y.length>8&&(l.birthDate=y.slice(1,9).replace(/(\d{2})(\d{2})(\d{4})/,"$3-$2-$1")))}function R(){const y=localStorage.getItem("form");if(!y)return;const e=JSON.parse(y);Object.keys(e).forEach(t=>{l[t]=e[t]})}async function D(){f.value="",localStorage.setItem("form",JSON.stringify(l));const y={},e=B.token;if(!e){console.error("No token");return}const t=new FormData;t.append("key",V.value);const T=["scanOfHousePassport","scanOfSketch","scanOfPassport","scanOfAgreement"],G=["plannedGasUsingDevices","gasConsumptionPattern"];Object.keys(l).forEach(d=>{T.includes(d)||G.includes(d)||t.append(d,l[d])}),T.forEach(d=>{const $=Array.isArray(l[d])?l[d]:[l[d]];for(const P of $)t.append("files",P)});const W=l.plannedGasUsingDevices;l.plannedGasUsingDevices=l.gasConsumptionPattern,l.gasConsumptionPattern=W,G.forEach(d=>{String(l[d]).split(",").forEach($=>{t.append(d,$)})});try{const d=String(V.value).toLowerCase(),$=await m(`v1/portal/applications/${d}`,{query:y,method:"POST",headers:{Authorization:`Bearer ${e}`},body:t});U.value=!0,c.value=10;let P=ve(()=>{c.value>0?c.value--:(clearInterval(P),M("/issues"))},1e3)}catch(d){const $=d?.data?.message||d?.message||"Не удалось отправить заявку";f.value=$,console.error(d)}}return(y,e)=>(u(),r("section",Ue,[s(U)?(u(),r("aside",$e,[a(g,{name:"mdi-alert-decagram-outline"}),e[39]||(e[39]=n("span",null,[p(" Созданная задача отобразится в списке "),n("b",null,"сразу после обработки филиалом")],-1)),a(O,{onClick:e[0]||(e[0]=t=>("navigateTo"in y?y.navigateTo:s(M))("/issues")),color:"seagreen",prependIcon:"mdi-check",style:{"margin-top":".8em",padding:".2em inherit","font-size":".7em"}},{default:S(()=>[e[38]||(e[38]=p("Далее",-1)),n("span",Be,"( "+v(s(c))+" )",1)]),_:1})])):k("",!0),n("section",Fe,[a(oe,{modelValue:s(V),"onUpdate:modelValue":e[1]||(e[1]=t=>Z(V)?V.value=t:null),autoselect:"",items:I},null,8,["modelValue"]),s(N)?(u(),r("section",Se,[a(O,{prependIcon:"mdi-file-document-alert-outline",onClick:R},{default:S(()=>[...e[40]||(e[40]=[p("Применить данные предыдущей заявки",-1)])]),_:1})])):k("",!0),s(V)==="NGV4"?(u(),r("form",{key:1,onSubmit:z(D,["prevent"])},[n("h2",null,[a(g,{name:"mdi-account-outline"}),e[41]||(e[41]=p(" Информация о владельце объекта",-1))]),a(i,{name:"surname",modelValue:s(l).surname,"onUpdate:modelValue":e[2]||(e[2]=t=>s(l).surname=t),label:"Фамилия"},null,8,["modelValue"]),a(i,{name:"name",modelValue:s(l).name,"onUpdate:modelValue":e[3]||(e[3]=t=>s(l).name=t),label:"Имя"},null,8,["modelValue"]),a(i,{name:"lname",modelValue:s(l).lastName,"onUpdate:modelValue":e[4]||(e[4]=t=>s(l).lastName=t),label:"Отчество"},null,8,["modelValue"]),n("h2",null,[a(g,{name:"mdi-office-building-marker-outline"}),e[42]||(e[42]=p(" Информация об объекте газификации",-1))]),a(i,{modelValue:s(l).address,"onUpdate:modelValue":e[5]||(e[5]=t=>s(l).address=t),name:"address",label:"Адрес"},null,8,["modelValue"]),a(b,{multiple:"",modelValue:s(l).scanOfHousePassport,"onUpdate:modelValue":e[6]||(e[6]=t=>s(l).scanOfHousePassport=t),label:"Скан. тех. паспорта на дом"},null,8,["modelValue"]),a(b,{multiple:"",modelValue:s(l).scanOfSketch,"onUpdate:modelValue":e[7]||(e[7]=t=>s(l).scanOfSketch=t),label:"Эскизный чертеж"},null,8,["modelValue"]),a(C,{multiple:"",modelValue:s(l).plannedGasUsingDevices,"onUpdate:modelValue":e[8]||(e[8]=t=>s(l).plannedGasUsingDevices=t),items:[{key:"плита",value:"Плита"},{key:"котел",value:"Котел"},{key:"газовая колонка",value:"Газовая колонка"}],label:"Планируемые газоиспользующие приборы"},null,8,["modelValue"]),a(C,{multiple:"",modelValue:s(l).gasConsumptionPattern,"onUpdate:modelValue":e[9]||(e[9]=t=>s(l).gasConsumptionPattern=t),items:[{key:"отопление",value:"Отопление"},{key:"горячее водоснабжение",value:"Горячее водоснабжение"},{key:"пищеприготовление",value:"Пищеприготовление"}],label:"Характер потребления газа"},null,8,["modelValue"]),n("h2",null,[a(g,{name:"mdi-card-account-details-outline"}),e[43]||(e[43]=p(" Паспортные данные",-1))]),a(i,{onChange:A,name:"tin",mask:"##############",modelValue:s(l).inn,"onUpdate:modelValue":e[10]||(e[10]=t=>s(l).inn=t),label:"ИНН"},null,8,["modelValue"]),a(C,{modelValue:s(l).gender,"onUpdate:modelValue":e[11]||(e[11]=t=>s(l).gender=t),items:[{key:"М",value:"Мужской"},{key:"Ж",value:"Женский"}],label:"Пол"},null,8,["modelValue"]),a(i,{name:"birthdate",modelValue:s(l).birthDate,"onUpdate:modelValue":e[12]||(e[12]=t=>s(l).birthDate=t),type:"date",label:"Дата рождения"},null,8,["modelValue"]),a(i,{name:"passportNum",modelValue:s(l).passportNum,"onUpdate:modelValue":e[13]||(e[13]=t=>s(l).passportNum=t),label:"Номер паспорта"},null,8,["modelValue"]),a(i,{name:"issueDate",modelValue:s(l).passportIssuedDate,"onUpdate:modelValue":e[14]||(e[14]=t=>s(l).passportIssuedDate=t),type:"date",label:"Дата выдачи"},null,8,["modelValue"]),a(i,{name:"issuedBy",modelValue:s(l).passportIssuedBy,"onUpdate:modelValue":e[15]||(e[15]=t=>s(l).passportIssuedBy=t),label:"Орган выдачи"},null,8,["modelValue"]),a(b,{multiple:"",modelValue:s(l).scanOfPassport,"onUpdate:modelValue":e[16]||(e[16]=t=>s(l).scanOfPassport=t),label:"Скан. паспорта с лицевой и обратной стороны"},null,8,["modelValue"]),n("h2",null,[a(g,{name:"mdi-phone-outline"}),e[44]||(e[44]=p(" Контактные данные",-1))]),a(i,{name:"email",modelValue:s(l).email,"onUpdate:modelValue":e[17]||(e[17]=t=>s(l).email=t),label:"Электронный адрес"},null,8,["modelValue"]),a(i,{name:"phone",mask:"996#########",modelValue:s(l).contactNumber,"onUpdate:modelValue":e[18]||(e[18]=t=>s(l).contactNumber=t),label:"Контактный номер"},null,8,["modelValue"]),a(i,{name:"whatsapp",mask:"996#########",modelValue:s(l).whatsAppNumber,"onUpdate:modelValue":e[19]||(e[19]=t=>s(l).whatsAppNumber=t),label:"WhatsApp номер"},null,8,["modelValue"]),a(b,{multiple:"",modelValue:s(l).scanOfAgreement,"onUpdate:modelValue":e[20]||(e[20]=t=>s(l).scanOfAgreement=t),label:"Скан. заявления о согласии на обработку ПД"},null,8,["modelValue"]),n("div",Oe,[a(O,{onClick:D,style:{"font-size":"1.2em",flex:"auto 1 0"},prependIcon:"mdi-content-save"},{default:S(()=>[...e[45]||(e[45]=[p("Сохранить",-1)])]),_:1})])],32)):s(V)==="PRV4"?(u(),r("form",Ne,[n("h2",null,[a(g,{name:"mdi-account-outline"}),e[46]||(e[46]=p(" Информация о владельце объекта",-1))]),a(i,{name:"account",modelValue:s(l).account,"onUpdate:modelValue":e[21]||(e[21]=t=>s(l).account=t),label:"Лицевой счет"},null,8,["modelValue"]),a(i,{name:"surname",modelValue:s(l).surname,"onUpdate:modelValue":e[22]||(e[22]=t=>s(l).surname=t),label:"Фамилия"},null,8,["modelValue"]),a(i,{name:"name",modelValue:s(l).name,"onUpdate:modelValue":e[23]||(e[23]=t=>s(l).name=t),label:"Имя"},null,8,["modelValue"]),a(i,{name:"lname",modelValue:s(l).lastName,"onUpdate:modelValue":e[24]||(e[24]=t=>s(l).lastName=t),label:"Отчество"},null,8,["modelValue"]),n("h2",null,[a(g,{name:"mdi-office-building-marker-outline"}),e[47]||(e[47]=p(" Информация об объекте газификации",-1))]),a(b,{multiple:"",modelValue:s(l).scanOfHousePassport,"onUpdate:modelValue":e[25]||(e[25]=t=>s(l).scanOfHousePassport=t),label:"Скан. тех. паспорта на дом"},null,8,["modelValue"]),a(b,{multiple:"",modelValue:s(l).scanOfSketch,"onUpdate:modelValue":e[26]||(e[26]=t=>s(l).scanOfSketch=t),label:"Эскизный чертеж"},null,8,["modelValue"]),n("h2",null,[a(g,{name:"mdi-card-account-details-outline"}),e[48]||(e[48]=p(" Паспортные данные",-1))]),a(i,{onChange:A,name:"tin",modelValue:s(l).inn,"onUpdate:modelValue":e[27]||(e[27]=t=>s(l).inn=t),label:"ИНН"},null,8,["modelValue"]),a(C,{modelValue:s(l).gender,"onUpdate:modelValue":e[28]||(e[28]=t=>s(l).gender=t),items:[{key:"М",value:"Мужской"},{key:"Ж",value:"Женский"}],label:"Пол"},null,8,["modelValue"]),a(i,{name:"birthdate",modelValue:s(l).birthDate,"onUpdate:modelValue":e[29]||(e[29]=t=>s(l).birthDate=t),type:"date",label:"Дата рождения"},null,8,["modelValue"]),a(i,{name:"passportNum",modelValue:s(l).passportNum,"onUpdate:modelValue":e[30]||(e[30]=t=>s(l).passportNum=t),label:"Номер паспорта"},null,8,["modelValue"]),a(i,{name:"issueDate",modelValue:s(l).passportIssuedDate,"onUpdate:modelValue":e[31]||(e[31]=t=>s(l).passportIssuedDate=t),type:"date",label:"Дата выдачи"},null,8,["modelValue"]),a(i,{name:"issuedBy",modelValue:s(l).passportIssuedBy,"onUpdate:modelValue":e[32]||(e[32]=t=>s(l).passportIssuedBy=t),label:"Орган выдачи"},null,8,["modelValue"]),a(b,{multiple:"",modelValue:s(l).scanOfPassport,"onUpdate:modelValue":e[33]||(e[33]=t=>s(l).scanOfPassport=t),label:"Скан. паспорта с лицевой и обратной стороны"},null,8,["modelValue"]),n("h2",null,[a(g,{name:"mdi-phone-outline"}),e[49]||(e[49]=p(" Контактные данные",-1))]),a(i,{name:"email",modelValue:s(l).email,"onUpdate:modelValue":e[34]||(e[34]=t=>s(l).email=t),label:"Электронный адрес"},null,8,["modelValue"]),a(i,{name:"phone",mask:"+996(###)### ###",modelValue:s(l).contactNumber,"onUpdate:modelValue":e[35]||(e[35]=t=>s(l).contactNumber=t),label:"Контактный номер"},null,8,["modelValue"]),a(i,{name:"whatsapp",mask:"+996(###)### ###",modelValue:s(l).whatsAppNumber,"onUpdate:modelValue":e[36]||(e[36]=t=>s(l).whatsAppNumber=t),label:"WhatsApp номер"},null,8,["modelValue"]),a(b,{multiple:"",modelValue:s(l).scanOfAgreement,"onUpdate:modelValue":e[37]||(e[37]=t=>s(l).scanOfAgreement=t),label:"Скан. заявления о согласии на обработку ПД"},null,8,["modelValue"]),n("div",Ce,[a(O,{onClick:D,style:{"font-size":"1.2em",flex:"auto 1 0"},prependIcon:"mdi-content-save"},{default:S(()=>[...e[50]||(e[50]=[p("Сохранить",-1)])]),_:1})])])):k("",!0),s(f)?(u(),r("div",Ie,v(s(f)),1)):k("",!0)])]))}});export{ze as default};
